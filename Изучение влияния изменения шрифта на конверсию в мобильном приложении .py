#!/usr/bin/env python
# coding: utf-8

# <div class="alert alert-success">
#   <b> ‚úîÔ∏è–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚úîÔ∏è</b>
# 
# –ü—Ä–∏–≤–µ—Ç, –î–µ–Ω–∏—Å! –ú–µ–Ω—è –∑–æ–≤—É—Ç –ú–∏—Ö–∞–∏–ª, —è –±—É–¥—É –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ç–≤–æ–π –ø—Ä–æ–µ–∫—Ç. –ü—Ä–µ–¥–ª–∞–≥–∞—é –æ–±—â–∞—Ç—å—Å—è –Ω–∞ '—Ç—ã' :)
# –û–¥–Ω–∞–∫–æ, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ—É–¥–æ–±–Ω–æ - —Å–æ–æ–±—â–∏, –∏ –º—ã –ø–µ—Ä–µ–π–¥–µ–º –Ω–∞ '–í—ã'. –ú–æ—è –≥–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å ‚Äî  –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Å —Ç–æ–±–æ–π —Å–≤–æ–∏–º –æ–ø—ã—Ç–æ–º –∏ –ø–æ–º–æ—á—å —Ç–µ–±–µ —Å—Ç–∞—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–º –¥–∞–Ω–Ω—ã—Ö, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —Ç–æ–±–æ–π –æ—à–∏–±–∫–∏.
# 
# –í–∏–¥–Ω–æ, —á—Ç–æ –∫ –ø—Ä–æ–µ–∫—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω –±–æ–ª—å—à–æ–π —Ç—Ä—É–¥. –í—Å–µ –∫–ª—é—á–µ–≤—ã–µ —ç—Ç–∞–ø—ã –≤ —Ä–∞–±–æ—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã, —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ. –¢–∞–∫ —á—Ç–æ –≤ —Ü–µ–ª–æ–º —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è —Å –∑–∞–¥–∞—á–µ–π —Ç–µ–±–µ —É–¥–∞–ª–æ—Å—å.
# 
# –ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞—Å–ø–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ **—Ç—Ä–µ–±—É—é—Ç** —Ç–≤–æ–µ–≥–æ **–≤–Ω–∏–º–∞–Ω–∏—è**. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ –Ω–∏–º –ø–æ–º–µ—á–µ–Ω—ã –∫—Ä–∞—Å–Ω—ã–º —Ü–≤–µ—Ç–æ–º –∏ —Å–∏–º–≤–æ–ª–∞–º–∏ ‚ùå. –ü–æ—Å–ª–µ –∏—Ö –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ–µ–∫—Ç –±—É–¥–µ—Ç –ø—Ä–∏–Ω—è—Ç, –æ—Å—Ç–∞–ª–æ—Å—å —Å–æ–≤—Å–µ–º –Ω–µ–º–Ω–æ–≥–æ :) 
#     
# 
# –î–∞–≤–∞–π —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥ –ø—Ä–æ–µ–∫—Ç–æ–º –≤ –¥–∏–∞–ª–æ–≥–µ: –µ—Å–ª–∏ **—Ç—ã —á—Ç–æ-—Ç–æ –º–µ–Ω—è–µ—à—å** –≤ –ø—Ä–æ–µ–∫—Ç–µ –ø–æ –º–æ–∏–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º ‚Äî **–ø–∏—à–∏ –æ–± —ç—Ç–æ–º**. –ú–Ω–µ –±—É–¥–µ—Ç –ª–µ–≥—á–µ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è, –µ—Å–ª–∏ —Ç—ã –±—É–¥–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏–Ω—é—é —Ñ–æ—Ä–º—É, –∫–æ—Ç–æ—Ä—É—é —è –ø—Ä–∏–∫—Ä–µ–ø–ª—é –Ω–∏–∂–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, **–Ω–µ –ø–µ—Ä–µ–º–µ—â–∞–π, –Ω–µ –∏–∑–º–µ–Ω—è–π –∏ –Ω–µ —É–¥–∞–ª—è–π –º–æ–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏**. –í—Å—ë —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–≤–æ–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–µ–µ. 
# 
# 
# 
# –ñ–¥—É –ø—Ä–æ–µ–∫—Ç –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ —Ä–µ–≤—å—é. –£—Å–ø–µ—Ö–æ–≤ –≤ –∏–∑—É—á–µ–Ω–∏–∏!
# 
# 
# 
# </div>
# <div class="alert alert-block alert-danger"> <b>‚ùå –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚ùå</b> 
#     –¢–∞–∫ —è –≤—ã–¥–µ–ª—è—é –º–æ–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±—É—é—Ç –æ—Å–æ–±–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è. –ù—É–∂–Ω–æ –±—É–¥–µ—Ç —É—á–µ—Å—Ç—å –∏—Ö –∏ –≤–Ω–µ—Å—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –≤ —Å–≤–æ—é —Ä–∞–±–æ—Ç—É. </div>
# <div class="alert alert-block alert-warning"> <b>‚ö†Ô∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚ö†Ô∏è</b> 
#     –ñ–µ–ª—Ç—ã–º —è –æ—Ç–º–µ—á—É —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ, –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã–º–∏ –ø—Ä–∏ —Ç–≤–æ–µ–π —Ä–∞–±–æ—Ç–µ. –û–Ω–∏ –Ω–æ—Å—è—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–æ–Ω–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä, –Ω–æ –±—É–¥–µ—Ç –∫–ª–∞—Å—Å–Ω–æ, –µ—Å–ª–∏ —Ç—ã –±—É–¥–µ—à—å —É—á–∏—Ç—ã–≤–∞—Ç—å –∏—Ö –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ.</div>
# <div class="alert alert-block alert-success"> <b>‚úîÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚úîÔ∏è</b>
#     –¢–∞–∫ —è –≤—ã–¥–µ–ª—è—é —É–¥–∞—á–Ω—ã–µ –∏ —ç–ª–µ–≥–∞–Ω—Ç–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –æ–ø–∏—Ä–∞—Ç—å—Å—è –≤ –±—É–¥—É—â–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö.</div>
# <div class="alert alert-block alert-info">
#     
# –ê –≤ —Ç–∞–∫–æ–º –±–ª–æ–∫–µ —Ç—ã –º–æ–∂–µ—à—å –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –º–µ–Ω—è 
#     
# </div>

# # –ò–∑—É—á–µ–Ω–∏–µ –≤–ª–∏—è–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —à—Ä–∏—Ñ—Ç–∞ –Ω–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏—é –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
# 
# 

# ## –¶–µ–ª—å –∏ –∑–∞–¥–∞—á–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è

# –¶–µ–ª—å –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è ‚Äì –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —à—Ä–∏—Ñ—Ç–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏—é –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

# –ó–∞–¥–∞—á–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è:
# * –°–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
# * –†–∞–∑–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –≥—Ä—É–ø–ø—É –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –≥—Ä—É–ø–ø—ã
# * –ò–∑–º–µ–Ω–∏—Ç—å —à—Ä–∏—Ñ—Ç –≤ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–µ
# * –°—Ä–∞–≤–Ω–∏—Ç—å –∫–æ–Ω–≤–µ—Ä—Å–∏—é –≤ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–µ —Å –∫–æ–Ω–≤–µ—Ä—Å–∏–µ–π –≤ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö –≥—Ä—É–ø–ø–∞—Ö
# * –°–¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥—ã –æ –≤–ª–∏—è–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —à—Ä–∏—Ñ—Ç–∞ –Ω–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏—é –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

# <div class="alert alert-success">
# 
# **‚úîÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚úîÔ∏è**
#    
#    –•–æ—Ä–æ—à–µ–µ –≤–≤–µ–¥–µ–Ω–∏–µ –≤ –ø—Ä–æ–µ–∫—Ç - –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è –≤ –±—É–¥—É—â–µ–º, –∫–æ–≥–¥–∞ —Å–æ–±–µ—Ä–µ—à—å –±–æ–ª—å—à–æ–µ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –∏ –æ—Ç–∫—Ä–æ–µ—à—å –ø—Ä–æ–µ–∫—Ç –≤–Ω–æ–≤—åüëç
# 
# </div>
# 

# ## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

# In[3]:


import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import plotly.graph_objs as go
from plotly.subplots import make_subplots
import scipy.stats as st 
import numpy as np
from scipy import stats
import math as mth


# In[4]:


data = pd.read_csv('/datasets/logs_exp.csv', sep = '\t')


# In[5]:


pd.set_option('display.precision',2)


# In[6]:


data.info()


# In[7]:


display(data.info())
display(data.head())
display(data.describe())
display('–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥—É–±–ª–µ–π:', data.duplicated().sum())


# In[8]:


data.columns = ['event_name', 'device_id', 'event_timestamp', 'group']


# In[9]:


print("–ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∫–∞–∂–¥–æ–º —Å—Ç–æ–ª–±—Ü–µ:")
print(data.isnull().sum())


# <div class="alert alert-block alert-info">
#     
# –í–æ—Ç –∑–¥–µ—Å—å —Ä–∞—Å—á–µ—Ç—ã –ø–æ –ø—Ä–æ–ø—É—Å–∫–∞–º</div>

# In[10]:


data['datetime'] = pd.to_datetime(data['event_timestamp'], unit='s')


# In[11]:


data['date'] = data['datetime'].dt.date


# In[12]:


data['date'] = data['date'].astype('datetime64')


# In[13]:


data[data.duplicated()==True].sort_values(by=['event_name', 'device_id', 'event_timestamp', 'group']).head(25)


# In[14]:


display(data.info())
display(data.head())
display(data.describe())


# ### –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –≤—ã–≤–æ–¥—ã –ø–æ –¥–∞–Ω–Ω—ã–º

# –ë—ã–ª–∏ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –¥–∞–Ω–Ω—ã—Ö:
# * –∏–∑–º–µ–Ω–µ–Ω—ã –Ω–∞–∑–≤–∞–Ω–∏—è —Å—Ç–æ–ª–±—Ü–æ–≤ –Ω–∞ –±–æ–ª–µ–µ —É–¥–æ–±–Ω—ã–µ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
# * –∏–∑–º–µ–Ω–µ–Ω —Ç–∏–ø —Å—Ç–æ–ª–±—Ü–∞ date
# * –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω –ø–æ–∏—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ ‚Äì –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ 413 –¥—É–±–ª–µ–π
# * –ø—Ä–æ–∑–≤–µ–¥–µ–Ω –ø–æ–∏—Å–∫ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π ‚Äì –ø—Ä–æ–ø—É—Å–∫–∏ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã

# <div class="alert alert-success">
# 
# **‚úîÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚úîÔ∏è**
#    
#    –û—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ, —á—Ç–æ –Ω–µ –∑–∞–±—ã–≤–∞–µ—à—å –ø—Ä–æ–≤–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤.  –ú–æ–ª–æ–¥–µ—Ü, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—à—å –¥–∞—Ç—ã –∫ –Ω—É–∂–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É.
# 
# </div>

# <div class="alert alert-danger">
# 
# **‚ùå –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚ùå**
#    
#    –°—Ç–æ–∏—Ç –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫–∞—Å–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –≤ –¥–∞–Ω–Ω—ã—Ö
# 
# </div>
# 

# <div class="alert alert-block alert-info">
#     
# –î–æ–±–∞–≤–∏–ª –≤ –≤—ã–≤–æ–¥–µ –∏–Ω—Ñ—É –ø–æ –¥—É–±–ª–∏–∫–∞—Ç–∞–º –∏ –ø–æ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º + –¥–æ–±–∞–≤–∏–ª —Ä–∞—Å—á–µ—Ç—ã –ø–æ –ø—Ä–æ–ø—É—Å–∫–∞–º    
# </div>

# <div class="alert alert-success">
# 
# **‚úîÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ v2‚úîÔ∏è**
#    
#    –î–∞, –ø—Ä–æ–ø—É—Å–∫–æ–≤ –Ω–µ—Ç - —ç—Ç–æ —Ö–æ—Ä–æ—à–æ. –ù–æ –Ω–µ –∑–∞–±—ã–≤–∞–π –æ –ø—Ä–æ–≤–µ—Ä–∫–µ
# 
# </div>
# 

# ## –ò–∑—É—á–∞–µ–º –∏ –ø—Ä–æ–≤–µ—Ä—è–º –¥–∞–Ω–Ω—ã–µ

# In[15]:


events_total = data.shape[0]
print("–í—Å–µ–≥–æ —Å–æ–±—ã—Ç–∏–π –≤ –ª–æ–≥–µ:", events_total)


# In[16]:


users_total = data['device_id'].nunique()
print("–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ª–æ–≥–µ:", users_total)


# In[17]:


events_per_user = events_total / users_total
print("–°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", events_per_user)


# In[18]:


print("–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞:", data['datetime'].min())
print("–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞:", data['datetime'].max())


# In[19]:



plt.hist(data['datetime'], bins=50)
plt.xlabel('–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è')

plt.ylabel('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π')
plt.title('–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –ø–æ –¥–∞—Ç–µ –∏ –≤—Ä–µ–º–µ–Ω–∏')
plt.xticks(rotation='vertical')
plt.show()


# <div class="alert alert-warning">
# 
# **‚ö†Ô∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚ö†Ô∏è**
#    
#    –†–µ–∫–æ–º–µ–Ω–¥—É—é –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É `plt.xticks(rotation='vertical')` —á—Ç–æ–±—ã –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ –û–• –Ω–µ –Ω–∞–∫–ª–∞–¥—ã–≤–∞–ª–∏—Å—å –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞
# 
# </div>
# 
# 
# 

# <div class="alert alert-block alert-info">
#     
# –î–æ–±–∞–≤–∏–ª, —Å–ø–∞—Å–∏–±–æ, —Å—Ç–∞–ª–æ –ª—É—á—à–µ, —É—á—Ç—É –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º
# </div>

# <div class="alert alert-success">
# 
# **‚úîÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ v2‚úîÔ∏è**
#    
#    üòâ
# 
# </div>
# 

# In[20]:


data = data[data['datetime'] >= '2019-08-01']


# In[21]:


events_lost = events_total - data.shape[0]
users_lost = users_total - data['device_id'].nunique()

print("–°–æ–±—ã—Ç–∏–π –ø–æ—Ç–µ—Ä—è–Ω–æ:", events_lost)
print("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ—Ç–µ—Ä—è–Ω–æ:", users_lost)


# In[22]:


event_fraction_lost = events_lost / events_total * 100
user_fraction_lost = users_lost / users_total * 100

print("–î–æ–ª—è –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π: {:.2f}%".format(event_fraction_lost))
print("–î–æ–ª—è –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {:.2f}%".format(user_fraction_lost))


# <div class="alert alert-danger">
# 
# **‚ùå –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚ùå**
#    
#    –†–µ–∫–æ–º–µ–Ω–¥—É—é —Ç–∞–∫–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å –¥–æ–ª–∏ –ø–æ—Ç–µ—Ä—å –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö - —Ç–∞–∫ –º—ã —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ –æ–Ω–∞ –º–∞–ª–∞
# 
# </div>
# 

# <div class="alert alert-block alert-info">
#     
# –î–æ–±–∞–≤–∏–ª –¥–æ–ª–∏, –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ, –¥–æ–ª—è –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ—á–µ–Ω—å –º–∞–ª–∞ 
#     
# </div>

# <div class="alert alert-success">
# 
# **‚úîÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ v2‚úîÔ∏è**
#    
#    –•–æ—Ä–æ—à–æ
# 
# </div>
# 

# In[23]:


data['group'].unique()


# In[24]:


# –∏–∑—É—á–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤ –ª–æ–≥–∞—Ö
events = data['event_name'].value_counts().reset_index()
events.columns = ['event_name', 'event_count']
print(events)


# In[25]:


# –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞
sns.set_style('whitegrid')
plt.figure(figsize=(10, 6))

# –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ–±—ã—Ç–∏–π –ø–æ —Ç–∏–ø–∞–º —Å–æ–±—ã—Ç–∏–π
sns.barplot(x='event_count', y='event_name', data=events, palette='rocket')

# –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –∏ –æ—Å–µ–π
plt.title('–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ–±—ã—Ç–∏–π –ø–æ —Ç–∏–ø–∞–º —Å–æ–±—ã—Ç–∏–π')
plt.xlabel('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π')
plt.ylabel('–¢–∏–ø —Å–æ–±—ã—Ç–∏—è')

# –≤—ã–≤–æ–¥ –≥—Ä–∞—Ñ–∏–∫–∞
plt.show()


# In[26]:


# –∫–æ–ª-–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–æ–≤–µ—Ä—à–∏–≤—à–∏—Ö –∫–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ
users_per_event = data.groupby('event_name')['device_id'].nunique().reset_index()
users_per_event.columns = ['event_name', 'unique_users']
print(users_per_event)


# In[27]:


users_per_event['user_ratio'] = users_per_event['unique_users'] / data['device_id'].nunique()
print(users_per_event)


# In[28]:


# –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞
sns.set_style('whitegrid')
plt.figure(figsize=(10, 6))

# —Å—Ç–æ–ª–±—á–∞—Ç–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —Ç–∏–ø–∞–º —Å–æ–±—ã—Ç–∏–π
sns.barplot(x='unique_users', y='event_name', data=users_per_event, palette='rocket')

# –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –∏ –æ—Å–µ–π
plt.title('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —Ç–∏–ø–∞–º —Å–æ–±—ã—Ç–∏–π')
plt.xlabel('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π')
plt.ylabel('–¢–∏–ø —Å–æ–±—ã—Ç–∏—è')

# –≤—ã–≤–æ–¥ –≥—Ä–∞—Ñ–∏–∫–∞
plt.show()


# ### –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –≤—ã–≤–æ–¥—ã –ø–æ –ø—Ä–µ–≤–µ—Ä–∫–µ –¥–∞–Ω–Ω—ã—Ö

#    *    –ù–∞ –≥—Ä–∞—Ñ–∏–∫–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ–±—ã—Ç–∏–π –ø–æ —Ç–∏–ø–∞–º —Å–æ–±—ã—Ç–∏–π –≤–∏–¥–Ω–æ, —á—Ç–æ –Ω–∞–∏–±–æ–ª—å—à–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π –±—ã–ª–æ —Å–≤—è–∑–∞–Ω–æ —Å –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º –≥–ª–∞–≤–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ (MainScreenAppear) –∏ –Ω–∞–∂–∞—Ç–∏–µ–º –∫–Ω–æ–ø–∫–∏ "–ö—É–ø–∏—Ç—å" –Ω–∞ —ç—Ç–æ–º —ç–∫—Ä–∞–Ω–µ (OffersScreenAppear). –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ–º –æ–±—É—á–µ–Ω–∏—è (Tutorial), –±—ã–ª–æ –Ω–∞–∏–º–µ–Ω—å—à–∏–º. –≠—Ç–æ –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ —Ç–æ, —á—Ç–æ –º–Ω–æ–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–∂–µ –∑–Ω–∞–∫–æ–º—ã —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –∏–ª–∏ –∏–º –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ
#    *    –ù–∞ –≥—Ä–∞—Ñ–∏–∫–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤–∏–¥–Ω–æ, —á—Ç–æ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–æ–≤–µ—Ä—à–∞–ª–∏ —Å–æ–±—ã—Ç–∏–µ MainScreenAppear (–ø–æ–∫–∞–∑ –≥–ª–∞–≤–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è), —á—Ç–æ –º–æ–∂–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å –æ —Ç–æ–º, —á—Ç–æ –æ–Ω–æ —è–≤–ª—è–µ—Ç—Å—è –Ω–∞–∏–±–æ–ª–µ–µ –≤–∞–∂–Ω—ã–º –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –î–∞–ª–µ–µ –∏–¥—É—Ç —Å–æ–±—ã—Ç–∏—è OffersScreenAppear (–ø–æ–∫–∞–∑ —ç–∫—Ä–∞–Ω–∞ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º–∏) –∏ CartScreenAppear (–ø–æ–∫–∞–∑ —ç–∫—Ä–∞–Ω–∞ —Å –∫–æ—Ä–∑–∏–Ω–æ–π). –°–æ–±—ã—Ç–∏–µ PaymentScreenSuccessful (—É—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂) –∏–º–µ–µ—Ç –Ω–∞–∏–º–µ–Ω—å—à–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —á—Ç–æ –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –Ω–∏–∑–∫—É—é –∫–æ–Ω–≤–µ—Ä—Å–∏—é –≤ –ø–æ–∫—É–ø–∫–∏
#    * –ù–∞ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –ø–æ –¥–∞—Ç–µ –∏ –≤—Ä–µ–º–µ–Ω–∏ –º–æ–∂–Ω–æ –∑–∞–º–µ—Ç–∏—Ç—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –æ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç –ø–µ—Ä–∏–æ–¥ —Å 25 –∏—é–ª—è –ø–æ 7 –∞–≤–≥—É—Å—Ç–∞ 2019 –≥–æ–¥–∞. –í —Ü–µ–ª–æ–º, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π –≤ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è, –¥–æ—Å—Ç–∏–≥–∞–µ—Ç –ø–∏–∫–∞ –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –ø–µ—Ä–∏–æ–¥–∞ –∏ –∑–∞—Ç–µ–º —Å–Ω–∏–∂–∞–µ—Ç—Å—è. –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –≤—ã–¥–µ–ª–∏—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∞–Ω–æ–º–∞–ª–∏–∏ –≤ –≤–∏–¥–µ –Ω–µ–±–æ–ª—å—à–∏—Ö –ø–∏–∫–æ–≤ –∏ —Å–ø–∞–¥–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω—ã —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã–º–∏ –≤–Ω–µ—à–Ω–∏–º–∏ —Ñ–∞–∫—Ç–æ—Ä–∞–º–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ–±—ã—Ç–∏—è–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –º–∏—Ä–µ –∏–ª–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏
#    * –í –ª–æ–≥–∞—Ö –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –í—Å–µ–≥–æ –ø–æ—Ç–µ—Ä—è–Ω–æ 2826 —Å–æ–±—ã—Ç–∏–π –∏ 17 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –í–∞–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å –Ω–∞ —ç—Ç–æ –≤–Ω–∏–º–∞–Ω–∏–µ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞
#    * –ï—Å—Ç—å —Ç—Ä–∏ –≥—Ä—É–ø–ø—ã –¥–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞: 246, 247, 248
#     

# <div class="alert alert-success">
# 
# **‚úîÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚úîÔ∏è**
#    
#    –•–æ—Ä–æ—à–æ. –ú—ã —É–±–µ–¥–∏–ª–∏—Å—å, —á—Ç–æ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –æ—Å—Ç–∞–ª–∏—Å—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ –≤—Å–µ–º —Ç—Ä–µ–º –≥—Ä—É–ø–ø–∞–º - –ø—Ä–∏—Å—Ç—É–ø–∏–º –∫ –∏–∑—É—á–µ–Ω–∏—é –≤–æ—Ä–æ–Ω–∫–∏
# 
# </div>
# 

# ## –í–æ—Ä–æ–Ω–∫–∞ —Å–æ–±—ã—Ç–∏–π

# <div class="alert alert-block alert-info">
#     
# –í–æ—Ç —Å –ø–æ–º–æ—â—å—é —ç—Ç–æ–π —Å—Ç—Ä–æ–∫–∏ —É–¥–∞–ª—è–µ–º –æ–±—É—á–µ–Ω–∏–µ –∏–∑ –≤–æ—Ä–æ–Ω–∫–∏    
# </div>

# In[29]:


data = data.drop(data[data['event_name'] == 'Tutorial'].index)


# In[30]:


# –°–æ–∑–¥–∞–µ–º DataFrame —Å –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è –≤–æ—Ä–æ–Ω–∫–∏
funnel_data = data.loc[data['event_name'] != '–û–±—É—á–µ–Ω–∏–µ']     .groupby('event_name', as_index=False)     .agg({'device_id': 'nunique'})     .sort_values(by='device_id', ascending=False)

# –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–ª–æ–Ω–∫—É —Å –¥–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
funnel_data['ratio'] = funnel_data['device_id'] / funnel_data['device_id'].max()

# –°–æ–∑–¥–∞–µ–º –≤–æ—Ä–æ–Ω–∫—É
fig = go.Figure(
    go.Funnel(
        y=funnel_data['event_name'],
        x=funnel_data['device_id'],
        textinfo="value+percent previous",
        textposition="inside",
        marker=dict(color=funnel_data['device_id'],
                    colorscale='RdBu',
                    reversescale=True
                    )
    )
)

# –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞
fig.update_layout(
    title='–í–æ—Ä–æ–Ω–∫–∞ —Å–æ–±—ã—Ç–∏–π',
    height=700,
    font=dict(size=15)
)

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥—Ä–∞—Ñ–∏–∫
fig.show()


# <div class="alert alert-block alert-info">
#     
# –ü–æ–ª—É—á–∏–ª–∞—Å—å –Ω–æ–≤–∞—è –≤–æ—Ä–æ–Ω–∫–∞ –±–µ–∑ Tutorial, —Å –∫–æ–Ω–µ—á–Ω—ã–º —ç—Ç–∞–ø–æ–º - –ü–æ–∫—É–ø–∫–∞</div>

# In[31]:


# —Ä–∞—Å—á—ë—Ç –¥–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ –≤–æ—Ä–æ–Ω–∫–∏
funnel_data['user_ratio'] = funnel_data['device_id'] / funnel_data['device_id'].iloc[0]

print(funnel_data)


# In[32]:


# –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
fig = make_subplots(rows=1, cols=2, 
                    specs=[[{'type':'domain'}, {'type':'domain'}]],
                    subplot_titles=['–î–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π', '–û—Ç–Ω–æ—à–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π']
                   )

fig.add_trace(
    go.Pie(labels=funnel_data['event_name'], values=funnel_data['user_ratio'], 
           name='–î–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π', hole=.3),
    1, 1
)

fig.add_trace(
    go.Pie(labels=funnel_data['event_name'][1:], values=funnel_data['user_ratio'].iloc[1:] / 
           funnel_data['user_ratio'].iloc[:-1], 
           name='–û—Ç–Ω–æ—à–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π', hole=.3),
    1, 2
)

fig.update_traces(textinfo='percent+label')
fig.update_layout(title_text='–í–æ—Ä–æ–Ω–∫–∞ —Å–æ–±—ã—Ç–∏–π', title_x=0.5)
fig.show()


# In[33]:


funnel_users = (data.groupby('event_name')
                 .agg({'device_id': 'nunique'})
                 .sort_values(by='device_id', ascending=False)
               )
funnel_users.columns = ['users_count']
funnel_users


# In[34]:


conversion = (funnel_users.loc['PaymentScreenSuccessful', 'users_count'] / 
              funnel_users.loc['MainScreenAppear', 'users_count'])
print('{:.2%}'.format(conversion))


# ### –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –≤—ã–≤–æ–¥—ã –ø–æ –≤–æ—Ä–æ–Ω–∫–µ —Å–æ–±—ã—Ç–∏–π

# * –ò–∑ –≥—Ä–∞—Ñ–∏–∫–∞ –≤–æ—Ä–æ–Ω–∫–∏ —Å–æ–±—ã—Ç–∏–π –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –≤—ã–≤–æ–¥—ã:
#   * –í—Å–µ–≥–æ –±—ã–ª–æ 5 —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π, –Ω–∞—á–∏–Ω–∞—è –æ—Ç –≥–ª–∞–≤–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ –¥–æ –æ–ø–ª–∞—Ç—ã
#   * –ë–æ–ª—å—à–∞—è —á–∞—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ—à–ª–∏ –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω, –ø–µ—Ä–µ—Ö–æ–¥–∏–ª–∏ –¥–∞–ª—å—à–µ –∫ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—é –æ –ø–æ–∫—É–ø–∫–µ, —á—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ —Ö–æ—Ä–æ—à–µ–π –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ —Å —ç—Ç–æ–≥–æ —à–∞–≥–∞
#   * –û–¥–Ω–∞–∫–æ, –∏–∑ —Ç–µ—Ö, –∫—Ç–æ –ø–µ—Ä–µ—à–µ–ª –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ –ø–æ–∫—É–ø–∫–µ, –¥–∞–ª–µ–∫–æ –Ω–µ –≤—Å–µ —Å–¥–µ–ª–∞–ª–∏ –ø–æ–∫—É–ø–∫—É
#   * –ú–µ–Ω–µ–µ –ø–æ–ª–æ–≤–∏–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø–µ—Ä–µ—à–µ–¥—à–∏—Ö –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ –ø–æ–∫—É–ø–∫–µ, –ø—Ä–æ—à–ª–∏ —ç—Ç–æ—Ç —à–∞–≥ –¥–æ –∫–æ–Ω—Ü–∞ –∏ –æ—Å—É—â–µ—Å—Ç–≤–∏–ª–∏ –æ–ø–ª–∞—Ç—É
#   * –ë–æ–ª—å—à–µ –≤—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ç–µ—Ä—è–µ—Ç—Å—è –Ω–∞ —à–∞–≥–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ –ø–æ–∫—É–ø–∫–µ –∏ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ
# * –ò–∑ —Ä–∞—Å—á–µ—Ç–∞ –¥–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –≤—ã–≤–æ–¥—ã:
#   * –ù–∞–∏–±–æ–ª—å—à–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—ã–ª–æ –Ω–∞ –ø–µ—Ä–≤–æ–º —ç—Ç–∞–ø–µ –≤–æ—Ä–æ–Ω–∫–∏ (MainScreenAppear) - 7419 —á–µ–ª–æ–≤–µ–∫. 
#   * –ù–∞ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —ç—Ç–∞–ø–∞—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è 
#   * –ù–∞ –≤—Ç–æ—Ä–æ–º —ç—Ç–∞–ø–µ (OffersScreenAppear) –æ—Å—Ç–∞—ë—Ç—Å—è 4201 —á–µ–ª–æ–≤–µ–∫, –Ω–∞ —Ç—Ä–µ—Ç—å–µ–º (CartScreenAppear) - 1767 —á–µ–ª–æ–≤–µ–∫, –∏ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º —ç—Ç–∞–ø–µ (PaymentScreenSuccessful) - 454 —á–µ–ª–æ–≤–µ–∫–∞
#   * –¢–∞–∫–∂–µ –±—ã–ª–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ user_ratio, –≤ –∫–æ—Ç–æ—Ä–æ–π –ø–æ—Å—á–∏—Ç–∞–Ω–∞ –¥–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —ç—Ç–∞–ø–∞ (MainScreenAppear)
#   * –ù–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º —ç—Ç–∞–ø–µ –≤–æ—Ä–æ–Ω–∫–∏ (PaymentScreenSuccessful) –æ–∫–∞–∑–∞–ª–æ—Å—å –≤—Å–µ–≥–æ 6.1% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—á–∞–ª–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º 
#   * –≠—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º, —á—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ç–µ—Ä—è–µ—Ç—Å—è –Ω–∞ –±–æ–ª–µ–µ —Ä–∞–Ω–Ω–∏—Ö —ç—Ç–∞–ø–∞—Ö
# * –ò–∑ –∞–Ω–∞–ª–∏–∑–∞ –≤–æ—Ä–æ–Ω–∫–∏ —Å–æ–±—ã—Ç–∏–π –º—ã –º–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –≤—ã–≤–æ–¥—ã:
#   * –ë–æ–ª—å—à–µ –≤—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω (38% –æ—Ç –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞), –Ω–æ —Ç–æ–ª—å–∫–æ 62% –∏–∑ –Ω–∏—Ö –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –Ω–∞ —ç–∫—Ä–∞–Ω –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
#   * –ù–∞ —ç–∫—Ä–∞–Ω –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –ø–µ—Ä–µ—Ö–æ–¥—è—Ç 23% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ—Ç –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞
#   * –î–∞–ª–µ–µ –Ω–∞ —ç–∫—Ä–∞–Ω –ø–ª–∞—Ç–µ–∂–µ–π –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ 48% –æ—Ç —Ç–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
#   * –ù–∞ —ç–∫—Ä–∞–Ω —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã –ø–æ–ø–∞–¥–∞—é—Ç —É–∂–µ 58% –æ—Ç –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
#   * –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤–æ—Ä–æ–Ω–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ç–µ—Ä—è–µ—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ –ø–µ—Ä–µ—Ö–æ–¥–∞ —Å –≥–ª–∞–≤–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ –Ω–∞ —ç–∫—Ä–∞–Ω –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π, –∞ —Ç–∞–∫–∂–µ –Ω–∞ —ç—Ç–∞–ø–µ –ø–µ—Ä–µ—Ö–æ–¥–∞ —Å —ç–∫—Ä–∞–Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –Ω–∞ —ç–∫—Ä–∞–Ω –ø–ª–∞—Ç–µ–∂–µ–π
#   * –¢–∞–∫–∂–µ –º—ã –≤–∏–¥–∏–º, —á—Ç–æ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –∫–∞–∂–¥–æ–º –ø–æ—Å–ª–µ–¥—É—é—â–µ–º —ç—Ç–∞–ø–µ –≤–æ—Ä–æ–Ω–∫–∏ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è
# * –ò–∑ —Ä–∞—Å—á–µ—Ç–∞ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
#   * –ü–æ–ª—É—á–µ–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –≤ 47.70%
#   * –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º–µ–Ω–µ–µ –ø–æ–ª–æ–≤–∏–Ω—ã –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—É—Å—Ç–∏–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –¥–æ—à–ª–∏ –¥–æ —ç—Ç–∞–ø–∞ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã
# 
# 
# 
# 
# 

# <div class="alert alert-success">
# 
# **‚úîÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚úîÔ∏è** 
#    
#    –û—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ - –ø—Ä–æ–±–ª–µ–º–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ - –ø—Ä–æ–≤–∞–ª –Ω–∞ –ø–µ—Ä–≤–æ–º —à–∞–≥–µ: –æ—Ç `MainScreenAppear` –∫ `OffersScreenAppear`. –í–µ—Ä–æ—è—Ç–Ω–æ, –Ω—É–∂–Ω–æ –ª—É—á—à–µ –ø—Ä–æ—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∫—É, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–ª–∏ –∫ `OffersScreen`.
#     
# 
# </div>
# 

# <div class="alert alert-danger">
# 
# **‚ùå –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚ùå**
#    
#    –ü—Ä–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –≤–æ—Ä–æ–Ω–æ–∫ –ø—Ä–∏–Ω—è—Ç–æ, —á—Ç–æ –∫–æ–Ω–µ—á–Ω—ã–π —ç—Ç–∞–ø - —Ü–µ–ª–µ–≤–æ–π. –£ –Ω–∞—Å —Ü–µ–ª—å - —ç—Ç–æ –ø–æ–∫—É–ø–∫–∞, –∞ –Ω–µ –æ–±—É—á–µ–Ω–∏–µ. –î–∞–ª–µ–µ —Ç—ã –µ–≥–æ —É–¥–∞–ª—è–µ—à—å - —Ä–µ–∫–æ–º–µ–Ω–¥—É—é —É–¥–∞–ª–∏—Ç—å –¥–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≤–æ—Ä–æ–Ω–∫–∏, —á—Ç–æ–±—ã –æ–Ω–∞ –±—ã–ª–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ –≤ –ª–æ–≥–∏—á–µ—Å–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
# 
# </div>
# 

# <div class="alert alert-block alert-info">
#     
# –£–¥–∞–ª–∏–ª Tutorial –∏–∑ –≤–æ—Ä–æ–Ω–∫–∏, –¥–æ–±–∞–≤–∏–ª —Å—Ç—Ä–æ—á–∫—É –∫–æ–¥–∞ –≤—ã—à–µ –¥–æ –≤–æ—Ä–æ–Ω–∫–∏, –µ—Å–ª–∏ —è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–Ω—è–ª, —á—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å.    
# </div>

# <div class="alert alert-success">
# 
# **‚úîÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ v2‚úîÔ∏è**
#    
#    –î–∞, —Ç–µ–ø–µ—Ä—å –≤—Å–µ –≤–µ—Ä–Ω–æ
# 
# </div>
# 

# ## –ò–∑—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞

# In[35]:


data.groupby('group')['device_id'].nunique()


# In[36]:


# –∑–∞–ø–∏—à–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ç–∞–±–ª–∏—Ü—É
users_by_group = data.groupby('group')['device_id'].nunique()
users_by_group['A1+A2'] = users_by_group[246] + users_by_group[247]
users_by_group


# In[37]:


user_only = data.groupby('device_id')['group'].nunique()
user_only_sorted = user_only.sort_values()
print("–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ, —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ—Å—Ç–æ—è–ª —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–µ:")
print(user_only_sorted)


# <div class="alert alert-danger">
# 
# **‚ùå –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚ùå**
#    
#    –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ, —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ—Å—Ç–æ—è–ª —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ –≥—Ä—É–ø–ø–µ, —Å—Ç–æ–∏—Ç –æ–± —ç—Ç–æ–º —É–∫–∞–∑–∞—Ç—å
# 
# </div>
# 

# <div class="alert alert-block alert-info">
#     
# –î–∞, –≤—Å–µ –≤–µ—Ä–Ω–æ, –∑–¥–µ—Å—å –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–∞–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –î–æ–±–∞–≤–∏–ª –≤ –≤—ã–≤–æ–¥–µ –Ω–∞ —ç–∫—Ä–∞–Ω, —á—Ç–æ —ç—Ç–æ –æ–Ω–æ    
# </div>

# <div class="alert alert-warning">
# 
# **‚ö†Ô∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ v2‚ö†Ô∏è**
#    
#    –¢–∞–∫–∂–µ –≤–æ–∑–º–æ–∂–Ω—ã–π —Å–ø–æ—Å–æ–± –ø—Ä–æ–≤–µ—Ä–∫–∏:
# 
# </div>
# 
# 
# 

# In[38]:


# –ö–æ–¥ —Ä–µ–≤—å—é–µ—Ä–∞
# –ü—Ä–æ–≤–µ—Ä–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥–ª–∏ —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –¥–≤—É—Ö –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≥—Ä—É–ø–ø–∞—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:
data.groupby('device_id').agg({'group':'nunique'}).query('group > 1') 


# In[39]:


event_group_test = data[data['event_name']!='Tutorial'].pivot_table(
    index='event_name', 
    columns='group', 
    values='device_id',
    aggfunc='nunique').sort_values(by=246, ascending=False)

event_group_test = event_group_test.reset_index()
event_group_test['A1+A2'] = event_group_test[246] + event_group_test[247]
event_group_test['all'] = event_group_test['A1+A2'] + event_group_test[248]

event_group_test['part_A1'] = (event_group_test[246] / users_by_group[247] * 100).round(1)
event_group_test['part_A2'] = (event_group_test[247] / users_by_group[247] * 100).round(1)
event_group_test['part_B'] = (event_group_test[248] / users_by_group[248] * 100).round(1)
event_group_test['part_A1+A2'] = ((event_group_test[246] + event_group_test[247]) /                                   (users_by_group[246] + users_by_group[247]) * 100).round(1)
event_group_test


# In[40]:


# –ë–∞—Ä-–≥—Ä–∞—Ñ–∏–∫–∏
event_group_test.plot(x='event_name', y=[246, 247, 248], kind='bar', figsize=(10,6))
plt.xlabel('–ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è')
plt.ylabel('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π')
plt.title('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø–µ –ø–æ —Å–æ–±—ã—Ç–∏—è–º')

# –ì—Ä–∞—Ñ–∏–∫-–ª–∏–Ω–∏—è
event_group_test.plot(x='event_name', y=['part_A1', 'part_A2', 'part_B'], kind='line', figsize=(10,6))
plt.xlabel('–ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è')
plt.ylabel('–î–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, %')
plt.title('–î–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø–µ –ø–æ —Å–æ–±—ã—Ç–∏—è–º')
plt.legend(loc='upper left')
plt.show()


# In[41]:


users_in_groups = data.groupby('group').agg({'device_id': 'nunique'}).reset_index()
users_in_groups.columns = ['group', 'users_count']
print(users_in_groups)


# –ì–∏–ø–æ—Ç–µ–∑–∞ H0: –î–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–æ–≤–µ—Ä—à–∏–≤—à–∏—Ö —Å–∞–º–æ–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ, –æ–¥–∏–Ω–∞–∫–æ–≤–∞ –≤ –æ–±–µ–∏—Ö –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö –≥—Ä—É–ø–ø–∞—Ö.
# 
# –ì–∏–ø–æ—Ç–µ–∑–∞ H1: –î–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–æ–≤–µ—Ä—à–∏–≤—à–∏—Ö —Å–∞–º–æ–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ, —Ä–∞–∑–ª–∏—á–Ω–∞ –≤ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö –≥—Ä—É–ø–ø–∞—Ö.

# In[42]:


# –í—ã–±–µ—Ä–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö –≥—Ä—É–ø–ø
control_group_1 = data[data['group'] == 246]
control_group_2 = data[data['group'] == 247]

# –ü–æ—Å—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø–µ
n1 = control_group_1['device_id'].nunique()
n2 = control_group_2['device_id'].nunique()

# –í—ã–±–µ—Ä–µ–º —Å–∞–º–æ–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
most_popular_event = data['event_name'].value_counts().index[0]

# –ü–æ—Å—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–æ–≤–µ—Ä—à–∏–≤—à–∏—Ö —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ –≤ –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø–µ
n1_event = control_group_1[control_group_1['event_name'] == most_popular_event]['device_id'].nunique()
n2_event = control_group_2[control_group_2['event_name'] == most_popular_event]['device_id'].nunique()

# –ü–æ—Å—á–∏—Ç–∞–µ–º –¥–æ–ª—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–æ–≤–µ—Ä—à–∏–≤—à–∏—Ö —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ –≤ –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø–µ
p1 = n1_event / n1
p2 = n2_event / n2

# –ü–æ—Å—á–∏—Ç–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É t-—Ç–µ—Å—Ç–∞ –∏ p-value
p_combined = (n1_event + n2_event) / (n1 + n2)
z_value = (p1 - p2) / np.sqrt(p_combined * (1 - p_combined) * (1 / n1 + 1 / n2))
p_value = stats.norm.sf(abs(z_value)) * 2

# –í—ã–≤–µ–¥–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
print('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ø–µ—Ä–≤–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–µ:', n1)
print('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤–æ –≤—Ç–æ—Ä–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–µ:', n2)
print('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–æ–≤–µ—Ä—à–∏–≤—à–∏—Ö —Å–∞–º–æ–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ –≤ –ø–µ—Ä–≤–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–µ:', n1_event)
print('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–æ–≤–µ—Ä—à–∏–≤—à–∏—Ö —Å–∞–º–æ–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ –≤–æ –≤—Ç–æ—Ä–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–µ:', n2_event)
print('–î–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–æ–≤–µ—Ä—à–∏–≤—à–∏—Ö —Å–∞–º–æ–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ –≤ –ø–µ—Ä–≤–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–µ:', p1)
print('–î–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–æ–≤–µ—Ä—à–∏–≤—à–∏—Ö —Å–∞–º–æ–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ –≤–æ –≤—Ç–æ—Ä–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–µ:', p2)
print('p-value:', p_value)

if p_value < 0.05:
    print('–û—Ç–≤–µ—Ä–≥–∞–µ–º –Ω—É–ª–µ–≤—É—é –≥–∏–ø–æ—Ç–µ–∑—É: –º–µ–∂–¥—É –¥–æ–ª—è–º–∏ –µ—Å—Ç—å –∑–Ω–∞—á–∏–º–∞—è —Ä–∞–∑–Ω–∏—Ü–∞')
else:
    print('–ù–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å –æ—Ç–≤–µ—Ä–≥–Ω—É—Ç—å –Ω—É–ª–µ–≤—É—é –≥–∏–ø–æ—Ç–µ–∑—É, –Ω–µ—Ç –æ—Å–Ω–æ–≤–∞–Ω–∏–π —Å—á–∏—Ç–∞—Ç—å –¥–æ–ª–∏ —Ä–∞–∑–Ω—ã–º–∏')


# <div class="alert alert-success">
# 
# **‚úîÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ v2‚úîÔ∏è**
#    
# 
#    
#    –í–æ—Ç –∑–¥–µ—Å—å —è –≤–∏–∂—É –ø—Ä–æ–≤–µ—Ä–∫—É —Å–æ–±—ã—Ç–∏—è MainScreen –≥—Ä—É–ø–ø 246 –∏ 247. 
# 
# </div>
# 

# In[43]:


test_group = data[data['group'] == 248]


# In[44]:


n3 = test_group['device_id'].nunique()


# In[45]:


n3_event = test_group[test_group['event_name'] == most_popular_event]['device_id'].nunique()


# In[46]:


event_counts_test = test_group['event_name'].value_counts()


# In[47]:


test_group_unique_users = test_group[test_group['device_id'].isin(control_group_1['device_id']) &
                                      test_group['device_id'].isin(control_group_2['device_id'])]
if len(test_group_unique_users) > 0:
    print('–í —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–µ –µ—Å—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏!')
else:
    print('–í —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–µ –Ω–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π!')


# H0: –ù–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º–æ–≥–æ —Ä–∞–∑–ª–∏—á–∏—è –¥–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–æ–≤–µ—Ä—à–∏–≤—à–∏—Ö –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ, –º–µ–∂–¥—É —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–æ–π –∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–æ–π (–≥—Ä—É–ø–ø—ã 1 –∏ 3).
# H1: –ï—Å—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º–æ–µ —Ä–∞–∑–ª–∏—á–∏–µ –¥–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–æ–≤–µ—Ä—à–∏–≤—à–∏—Ö –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ, –º–µ–∂–¥—É —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–æ–π –∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–æ–π (–≥—Ä—É–ø–ø—ã 1 –∏ 3).
# 
# H0: –ù–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º–æ–≥–æ —Ä–∞–∑–ª–∏—á–∏—è –¥–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–æ–≤–µ—Ä—à–∏–≤—à–∏—Ö –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ, –º–µ–∂–¥—É —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–æ–π –∏ –≤—Ç–æ—Ä–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–æ–π (–≥—Ä—É–ø–ø—ã 2 –∏ 3).
# H1: –ï—Å—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º–æ–µ —Ä–∞–∑–ª–∏—á–∏–µ –¥–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–æ–≤–µ—Ä—à–∏–≤—à–∏—Ö –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ, –º–µ–∂–¥—É —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–æ–π –∏ –≤—Ç–æ—Ä–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–æ–π (–≥—Ä—É–ø–ø—ã 2 –∏ 3).
# 
# H0: –ù–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º–æ–≥–æ —Ä–∞–∑–ª–∏—á–∏—è –¥–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–æ–≤–µ—Ä—à–∏–≤—à–∏—Ö –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ, –º–µ–∂–¥—É –ø–µ—Ä–≤–æ–π –∏ –≤—Ç–æ—Ä–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–º–∏ –≥—Ä—É–ø–ø–∞–º–∏ (–≥—Ä—É–ø–ø—ã 1 –∏ 2).
# H1: –ï—Å—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º–æ–µ —Ä–∞–∑–ª–∏—á–∏–µ –¥–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–æ–≤–µ—Ä—à–∏–≤—à–∏—Ö –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ, –º–µ–∂–¥—É –ø–µ—Ä–≤–æ–π –∏ –≤—Ç–æ—Ä–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–º–∏ –≥—Ä—É–ø–ø–∞–º–∏ (–≥—Ä—É–ø–ø—ã 1 –∏ 2).

# In[48]:


all_groups = data.pivot_table(index='event_name', columns='group',values='device_id',aggfunc='nunique')                       .sort_values(246,ascending=False)
all_groups['246+247'] = all_groups[246] + all_groups[247]
all_groups


# In[49]:


users = data.groupby('group')['device_id'].nunique()


# In[50]:


users= users.to_frame().reset_index()
users.loc[3] = ['246+247', 4997]


# In[51]:


users = users.set_index(users.columns[0])
users


# In[60]:


num_hypothesis = 16
alpha_bonf = 0.05 / num_hypothesis
print('–ó–Ω–∞—á–µ–Ω–∏–µ –ë–æ–Ω—Ñ–µ—Ä—Ä–æ–Ω–∏:',bonferroni)


# In[61]:


def z_test(exp1, exp2, event, alpha_bonf):
    p1_ev = all_groups.loc[event, exp1]
    p2_ev = all_groups.loc[event, exp2] 
    p1_us = users.loc[exp1, 'device_id'] 
    p2_us = users.loc[exp2, 'device_id'] 
    p1 = p1_ev / p1_us 
    p2 = p2_ev / p2_us 
    difference = p1 - p2
    p_combined = (p1_ev + p2_ev) / (p1_us + p2_us) 
    z_value = difference / mth.sqrt(p_combined * (1 - p_combined) * (1 / p1_us + 1 / p2_us))
    distr = st.norm(0, 1)
    p_value = (1 - distr.cdf(abs(z_value))) * 2

    alpha = alpha_bonf / 2 # —É—Ä–æ–≤–µ–Ω—å –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏ –¥–ª—è –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ t-—Ç–µ—Å—Ç–∞
    if (p_value < alpha):
        print('–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è  {} –∏ {}, —Å–æ–±—ã—Ç–∏–µ: {}, p-–∑–Ω–∞—á–µ–Ω–∏–µ: {p_value:.5f} - —Ä–∞–∑–ª–∏—á–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º–æ'.format(exp1, exp2, event, p_value=p_value))
    else:
        print('–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è  {} –∏ {}, —Å–æ–±—ã—Ç–∏–µ: {}, p-–∑–Ω–∞—á–µ–Ω–∏–µ: {p_value:.5f} - —Ä–∞–∑–ª–∏—á–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –Ω–µ –∑–Ω–∞—á–∏–º–æ'.format(exp1, exp2, event, p_value=p_value))


# In[62]:


for event in all_groups.index:
    z_test(246, 247, event, 0.05)
    print()


# In[55]:


for event in all_groups.index:
    z_test(246, 248, event, 0.05)
    print()


# In[56]:


for event in all_groups.index:
    z_test(247, 248, event, 0.05)
    print()


# In[57]:


for event in all_groups.index:
    z_test('246+247', 248, event, 0.05)
    print()


# <div class="alert alert-danger">
# 
# **‚ùå –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚ùå**
#    
#    –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –ø–æ–ø—Ä–∞–≤–∫–∏ –ë–æ–Ω—Ñ–µ—Ä—Ä–æ–Ω–∏ –º—ã –¥–µ–ª–∏–º –∞–ª—å—Ñ–∞ –Ω–∞ —á–∏—Å–ª–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã—Ö –Ω—É–ª–µ–≤—ã—Ö –≥–∏–ø–æ—Ç–µ–∑ - —É –Ω–∞—Å –¥–æ–ª–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å—Å—è 16 –ø—Ä–æ–≤–µ—Ä–æ–∫ - —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º 4 —Å–æ–±—ã—Ç–∏—è –≤ –∫–∞–∂–¥–æ–º –∏–∑ —Å—Ä–∞–≤–Ω–µ–Ω–∏–π –≥—Ä—É–ø–ø 246/247, 246/248, 247/248 –∏ 246+247/248 - –¥–µ–ª–∏—Ç—å –∞–ª—å—Ñ–∞ –Ω—É–∂–Ω–æ –Ω–∞ 16 –≤–æ –≤—Å–µ—Ö —Å–ª—É—á–∞—è—Ö
# 
# </div>
# 

# <div class="alert alert-block alert-info">
#     
# –ü–æ–º–µ–Ω—è–ª –∑–Ω–∞—á–µ–Ω–∏–µ num_hypotheses —Å 3 –Ω–∞ 16 </div>

# <div class="alert alert-danger">
# 
# **‚ùå –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ v2‚ùå**
#    
#    –ê –∫–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —Å–∞–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏? –Ø –≤–∏–∂—É, —á—Ç–æ –≤—ã—à–µ —Ç—ã –ø—Ä–æ–≤–µ—Ä—è–µ—à—å —Å–æ–±—ã—Ç–∏–µ MainScreen —É –≥—Ä—É–ø–ø 246/247, –Ω–æ –¥–∞–ª–µ–µ, 16-—Ç–∏ –ø—Ä–æ–≤–µ—Ä–æ–∫, –æ–ø–∏—Å–∞–Ω–Ω—ã—Ö –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, —è –Ω–µ –≤–∏–∂—É. –ú—ã –º–æ–∂–µ–º –æ–±–µ—Ä–Ω—É—Ç—å –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ MainScreen –≤ —Ñ—É–Ω–∫—Ü–∏—é –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥–∞–ª–µ–µ –¥–ª—è —Å–æ–±—ã—Ç–∏—è OffersScreen —É —Ç–µ—Ö –∂–µ –≥—Ä—É–ø–ø, –∑–∞—Ç–µ–º CartScreen –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ, –ø—Ä–æ—Ö–æ–¥—è –ø–æ –∫–∞–∂–¥–æ–º—É –∏–∑ —Å–æ–±—ã—Ç–∏–π –≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è—Ö –≥—Ä—É–ø–ø 246/247, 246/248, 247/248 246+247/248 
# 
# </div>
# 

# <div class="alert alert-block alert-info">
#     
# –î–æ–±–∞–≤–∏–ª —Ä–∞—Å—á–µ—Ç—ã –¥–ª—è 16 –≥—Ä—É–ø–ø </div>
# <div class="alert alert-success">
# 
# **‚úîÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ v3‚úîÔ∏è**
#    
#    –¢–µ–ø–µ—Ä—å –≤–µ—Ä–Ω–æüëç
# 
# </div>
# 

# <div class="alert alert-success">
# 
# **‚úîÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ v3‚úîÔ∏è**
#    
# 
# 
#    
#    –û—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ, –º—ã —Ä–∞–∑–æ–±—Ä–∞–ª–∏—Å—å —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –ø–æ–ø—Ä–∞–≤–∫–∏ –ë–æ–Ω—Ñ–µ—Ä—Ä–æ–Ω–∏. –û–¥–Ω–∞–∫–æ –æ—Ç–º–µ—á—É, —á—Ç–æ –¥–∞–Ω–Ω–∞—è –ø–æ–ø—Ä–∞–≤–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–¥–∫–æ. –ü—Ä–∏—á–∏–Ω—ã: —ç—Ç–∞ –ø–æ–ø—Ä–∞–≤–∫–∞ —Å–ª–∏—à–∫–æ–º —Å–∏–ª—å–Ω–æ —É–º–µ–Ω—å—à–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –∞–ª—å—Ñ–∞, –æ–ø—Ä–æ–≤–µ—Ä–≥–Ω—É—Ç—å –Ω—É–ª–µ–≤—É—é –≥–∏–ø–æ—Ç–µ–∑—É —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ; –ø–æ–≤—ã—à–∞–µ—Ç—Å—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Å–æ–≤–µ—Ä—à–∏—Ç—å –æ—à–∏–±–∫—É –≤—Ç–æ—Ä–æ–≥–æ —Ä–æ–¥–∞. –í–æ–∑–º–æ–∂–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ–Ω–µ–µ –º–æ—â–Ω—ã–µ –ø–æ–ø—Ä–∞–≤–∫–∏ - —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å–æ —Å—Ç–∞—Ç—å–µ–π: https://studfile.net/preview/10706903/page:19/
# –¢–∞–∫–∂–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é —Å—Ç–∞—Ç—å—é: https://habr.com/ru/company/yandex/blog/476826/ - –≤ –Ω–µ–π –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `statsmodels` - –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º                    
# 
# </div>
# 
# 
# 

# ### –í—ã–≤–æ–¥—ã –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞

#    * –ò–∑ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥—ã, —á—Ç–æ –≤ –¥–∞–Ω–Ω–æ–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏ –Ω–µ –±—ã–ª–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º—ã—Ö —Ä–∞–∑–ª–∏—á–∏–π –º–µ–∂–¥—É –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–º–∏ –≥—Ä—É–ø–ø–∞–º–∏
#    * –í —á–∞—Å—Ç–Ω–æ—Å—Ç–∏, –Ω–µ –±—ã–ª–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ —Ä–∞–∑–ª–∏—á–∏–π –≤ –¥–æ–ª–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–æ–≤–µ—Ä—à–∏–≤—à–∏—Ö —Å–∞–º–æ–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ 
#    * –≠—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –≤–Ω–µ—Å–µ–Ω—ã –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –Ω–µ –ø–æ–≤–ª–∏—è–ª–∏ –Ω–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∞ –∑–Ω–∞—á–∏—Ç, —ç—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º–∏ 
#    * –û–¥–Ω–∞–∫–æ, —Å–ª–µ–¥—É–µ—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ —ç—Ç–æ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –Ω–µ–ª—å–∑—è –¥–µ–ª–∞—Ç—å –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–µ –≤—ã–≤–æ–¥—ã, –ø–æ—Å–∫–æ–ª—å–∫—É –æ–Ω–æ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫—É—é –º–æ—â–Ω–æ—Å—Ç—å, –∞ —Ç–∞–∫–∂–µ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –º–Ω–æ–≥–∏–µ –¥—Ä—É–≥–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
#    * –ó–Ω–∞—á–µ–Ω–∏—è p-value –≤—ã—Å–æ–∫–∏–µ –¥–ª—è –≤—Å–µ—Ö —Ç—Ä–µ—Ö —Å—Ä–∞–≤–Ω–µ–Ω–∏–π, —á—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º, —á—Ç–æ –Ω–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º—ã—Ö —Ä–∞–∑–ª–∏—á–∏–π –º–µ–∂–¥—É –≥—Ä—É–ø–ø–∞–º–∏ 
#    * –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –º—ã –Ω–µ –º–æ–∂–µ–º –æ—Ç–≤–µ—Ä–≥–Ω—É—Ç—å –Ω—É–ª–µ–≤—É—é –≥–∏–ø–æ—Ç–µ–∑—É –æ —Ç–æ–º, —á—Ç–æ —Ä–∞–∑–ª–∏—á–∏–π –≤ –ø–æ–≤–µ–¥–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –≥—Ä—É–ø–ø–∞—Ö –Ω–µ—Ç

# ## –ò—Ç–æ–≥–æ–≤—ã–µ –≤—ã–≤–æ–¥—ã

# –í —Ö–æ–¥–µ –¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –±—ã–ª–∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–∏—Ç–∞–Ω–∏—è. –í –∫–∞—á–µ—Å—Ç–≤–µ —Ü–µ–ª–µ–π –±—ã–ª–∏ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω—ã:
# 
# * –ò–∑—É—á–∏—Ç—å –≤–æ—Ä–æ–Ω–∫—É –ø—Ä–æ–¥–∞–∂ –∏ –≤—ã—è–≤–∏—Ç—å —ç—Ç–∞–ø—ã, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö —Ç–µ—Ä—è–µ—Ç—Å—è –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
# * –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã A/A/B-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –µ—Å—Ç—å –ª–∏ —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–º–∏ –∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–∞–º–∏
#     
# –í —Ö–æ–¥–µ –∞–Ω–∞–ª–∏–∑–∞ –≤–æ—Ä–æ–Ω–∫–∏ –ø—Ä–æ–¥–∞–∂ –±—ã–ª–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, —á—Ç–æ:
# * –ù–∞–∏–±–æ–ª—å—à–∏–µ –ø–æ—Ç–µ—Ä–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –Ω–∞ —ç—Ç–∞–ø–µ –ø–µ—Ä–µ—Ö–æ–¥–∞ –æ—Ç –≥–ª–∞–≤–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ –∫ —ç–∫—Ä–∞–Ω—É –≤—ã–±–æ—Ä–∞ —Ç–æ–≤–∞—Ä–∞
# * –í–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å —Ç–µ–º, —á—Ç–æ –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ –Ω–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ–º, –∫–∞–∫–∏–µ —Ç–æ–≤–∞—Ä—ã –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
# * –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É–ª—É—á—à–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –≥–ª–∞–≤–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—ã–ª–∏ –±–æ–ª–µ–µ –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω—ã –≤ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
# 
# –í —Ö–æ–¥–µ –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ A/A/B-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±—ã–ª–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, —á—Ç–æ: 
# * –†–∞–∑–ª–∏—á–∏–π –º–µ–∂–¥—É –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–º–∏ –≥—Ä—É–ø–ø–∞–º–∏ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ 
# * –í —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–µ –¥–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –¥–æ—à–µ–¥—à–∏—Ö –¥–æ —ç–∫—Ä–∞–Ω–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞, –æ–∫–∞–∑–∞–ª–∞—Å—å –Ω–∞ 10% –≤—ã—à–µ, —á–µ–º –≤ —Å—Ä–µ–¥–Ω–µ–º –ø–æ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–º –≥—Ä—É–ø–ø–∞–º
# * –ü—Ä–∏ —ç—Ç–æ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º—ã—Ö —Ä–∞–∑–ª–∏—á–∏–π –º–µ–∂–¥—É —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–º–∏ –≥—Ä—É–ø–ø–∞–º–∏ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–æ —Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º —Ä–∞–∑–º–µ—Ä–æ–º –≤—ã–±–æ—Ä–∫–∏
# * –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Å—Ç–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º —Ä–∞–∑–º–µ—Ä–æ–º –≤—ã–±–æ—Ä–∫–∏, —á—Ç–æ–±—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏–ª–∏ –æ–ø—Ä–æ–≤–µ—Ä–≥–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ–∫—É—â–µ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

# <div class="alert alert-success">
# 
# **‚úîÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚úîÔ∏è**
#    
#    –î–µ–Ω–∏—Å, –ø—Ä–æ–≤–µ–¥–µ–Ω –æ—Å–Ω–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∏ –ø–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑. –í—Å–µ –Ω–∞–≥–ª—è–¥–Ω–æ - –≥—Ä–∞—Ñ–∏–∫–∏ –∏ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –≤—ã–≤–æ–¥—ã. –£—á—Ç–∏ –º–æ–∏ –∑–∞–º–µ—á–∞–Ω–∏—è. –í–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–∏–¥–µ—Ç—Å—è –Ω–µ–º–Ω–æ–≥–æ –ø–æ–¥–ø—Ä–∞–≤–∏—Ç—å –≤—ã–≤–æ–¥—ã. –ñ–¥—É —Ç–≤–æ–π –ø—Ä–æ–µ–∫—Ç –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ —Ä–µ–≤—å—é. –£—Å–ø–µ—Ö–æ–≤!
# 
# </div>
# 

# <div class="alert alert-success">
# 
# **‚úîÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ v3‚úîÔ∏è**
#    
#    –î–µ–Ω–∏—Å, –∑–∞–º–µ—á–∞–Ω–∏—è —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã üëç. –£–≤–µ—Ä–µ–Ω, –º–æ–∏ —Å–æ–≤–µ—Ç—ã –ø—Ä–∏–≥–æ–¥—è—Ç—Å—è —Ç–µ–±–µ –≤ –Ω–æ–≤—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö. –£—Å–ø–µ—Ö–æ–≤ –≤ –æ–±—É—á–µ–Ω–∏–∏! üòâ 
# 
# </div>

# In[ ]:




