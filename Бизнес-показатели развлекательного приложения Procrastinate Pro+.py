#!/usr/bin/env python
# coding: utf-8

# <div style="border:solid green 2px; padding: 20px">
#     
# <b>–î–µ–Ω–∏—Å, –ø—Ä–∏–≤–µ—Ç!</b> –ú—ã —Ä–∞–¥—ã —Ç–µ–±—è –≤–∏–¥–µ—Ç—å –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –∫–æ–¥-—Ä–µ–≤—å—é–µ—Ä–æ–≤. –¢—ã –ø—Ä–æ–¥–µ–ª–∞–ª –±–æ–ª—å—à—É—é —Ä–∞–±–æ—Ç—É –Ω–∞–¥ –ø—Ä–æ–µ–∫—Ç–æ–º, –Ω–æ –¥–∞–≤–∞–π –ø–æ–∑–Ω–∞–∫–æ–º–∏–º—Å—è –∏ —Å–¥–µ–ª–∞–µ–º –µ–≥–æ –µ—â–µ –ª—É—á—à–µ! –£ –Ω–∞—Å —Ç—É—Ç —Å–≤–æ—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞ –∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∞–≤–∏–ª:
# 
# 
# 1. –ú–µ–Ω—è –∑–æ–≤—É—Ç –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ú–∞—Ç–≤–µ–µ–≤—Å–∫–∏–π. –Ø —Ä–∞–±–æ—Ç–∞—é –∫–æ–¥-—Ä–µ–≤—å—é–µ—Ä–æ–º, –º–æ—è –æ—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å ‚Äî –Ω–µ —É–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —Ç–æ–±–æ—é –æ—à–∏–±–∫–∏, –∞ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Å–≤–æ–∏–º –æ–ø—ã—Ç–æ–º –∏ –ø–æ–º–æ—á—å —Ç–µ–±–µ —Å—Ç–∞—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–º –¥–∞–Ω–Ω—ã—Ö.
# 2. –û–±—â–∞–µ–º—Å—è –Ω–∞ —Ç—ã.
# 3. –ï—Å–ª–∏ —Ö–æ—á–µ—à—å –Ω–∞–ø–∏—Å–∞—Ç—å, —Å–ø—Ä–æ—Å–∏—Ç—å - –Ω–µ –Ω—É–∂–Ω–æ —Å—Ç–µ—Å–Ω—è—Ç—å—Å—è. –¢–æ–ª—å–∫–æ –≤—ã–±–µ—Ä–∏ —Å–≤–æ–π —Ü–≤–µ—Ç –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è.  
# 4. –≠—Ç–æ —É—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç, —Ç—É—Ç –º–æ–∂–Ω–æ –Ω–µ –±–æ—è—Ç—å—Å—è —Å–¥–µ–ª–∞—Ç—å –æ—à–∏–±–∫—É.  
# 5. –£ —Ç–µ–±—è –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –¥–ª—è —Å–¥–∞—á–∏ –ø—Ä–æ–µ–∫—Ç–∞.  
# 6. Let's Go!
# 
# ---
# 
# –Ø –±—É–¥—É –∫—Ä–∞—Å–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Ü–≤–µ—Ç–æ–º, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ —É–¥–∞–ª—è–π –∏—Ö:
# 
# <div class="alert alert-block alert-danger">‚úç
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ1__
# 
# –¢–∞–∫–æ–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –æ–Ω –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–ª–∏—è–µ—Ç –Ω–∞ —É–¥–∞—á–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞.
# </div>
#     
# ---
# 
# <div class="alert alert-block alert-warning">üìù
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ1__
# 
# 
# –¢–∞–∫–æ–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —è–≤–ª—è–µ—Ç—Å—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–µ–π –∏–ª–∏ —Å–æ–≤–µ—Ç–æ–º. –ú–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –Ω–∞ —Å–≤–æ—ë —É—Å–º–æ—Ç—Ä–µ–Ω–∏–µ.
# </div>
# 
# ---
# 
# <div class="alert alert-block alert-success">‚úîÔ∏è
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ1__
# 
# –¢–∞–∫–æ–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π  –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º, —á—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ —á—Ç–æ-—Ç–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ =)
# </div>
#     
# ---
#     
# –ü—Ä–µ–¥–ª–∞–≥–∞—é —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥ –ø—Ä–æ–µ–∫—Ç–æ–º –≤ –¥–∏–∞–ª–æ–≥–µ: –µ—Å–ª–∏ —Ç—ã —á—Ç–æ-—Ç–æ –º–µ–Ω—è–µ—à—å –≤ –ø—Ä–æ–µ–∫—Ç–µ –∏–ª–∏ –æ—Ç–≤–µ—á–∞–µ—à—å –Ω–∞ –º–æ–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ‚Äî –ø–∏—à–∏ –æ–± —ç—Ç–æ–º. –ú–Ω–µ –±—É–¥–µ—Ç –ª–µ–≥—á–µ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è, –µ—Å–ª–∏ —Ç—ã –≤—ã–¥–µ–ª–∏—à—å —Å–≤–æ–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:   
#     
# <div class="alert alert-info"> <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞:</b> –ù–∞–ø—Ä–∏–º–µ—Ä, –≤–æ—Ç —Ç–∞–∫.</div>
#     
# –í—Å—ë —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–≤–æ–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–µ–µ. –ï—Å–ª–∏ –±—É–¥—É—Ç –∫–∞–∫–∏–µ-–Ω–∏–±—É–¥—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ –º–æ–∏–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º, –ø–∏—à–∏, –±—É–¥–µ–º —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –≤–º–µ—Å—Ç–µ :)    
#     
# ---

# 

# 

# <div class="alert alert-block alert-danger">‚úç
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ1__
# 
# 
# –û—Ç–ª–∏—á–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ - —Ä–∞—Å–ø–∏—Å—ã–≤–∞—Ç—å —Ü–µ–ª—å –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —ç—Ç–∞–ø—ã —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏ (—ç—Ç–æ—Ç –Ω–∞–≤—ã–∫ –æ—á–µ–Ω—å –ø–æ–º–æ–∂–µ—Ç –Ω–∞ —Ñ–∏–ª—å–Ω–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ). –•–æ—Ä–æ—à–æ –±—ã–ª–æ –±—ã –¥–æ–±–∞–≤–∏—Ç—å —Ö–æ–¥ –∏ —Ü–µ–ª—å –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è. –í–æ—Ç –º–æ–π –ª–∏—á–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∏–∑ 3 –ø—Ä–æ–µ–∫—Ç–∞: 
#     
# ![image.png](attachment:image.png)
# </div>

# 

# # –ë–∏–∑–Ω–µ—Å-–ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Ä–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Procrastinate Pro+

# –ó–∞–∫–∞–∑—á–∏–∫
# 
# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Procrastinate Pro+
# 
# –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞
# 
# –ù–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–µ–π, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑ –∏ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã:
# 
# –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—Ö–æ–¥—è—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –∫–∞–∫–∏–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ –æ–Ω–∏ –ø–æ–ª—å–∑—É—é—Ç—Å—è,
# —Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤;
# —Å–∫–æ–ª—å–∫–æ –¥–µ–Ω–µ–≥ –ø—Ä–∏–Ω–æ—Å–∏—Ç –∫–∞–∂–¥—ã–π –∫–ª–∏–µ–Ω—Ç,
# –∫–æ–≥–¥–∞ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –æ–∫—É–ø–∞—é—Ç—Å—è,
# –∫–∞–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã –º–µ—à–∞—é—Ç –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—é –∫–ª–∏–µ–Ω—Ç–æ–≤.—å

# –•–æ–¥ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
# 
# –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥—ë—Ç –≤ —á–µ—Ç—ã—Ä–µ —ç—Ç–∞–ø–∞:
# 
# –û–±–∑–æ—Ä –∏ –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö;
# –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö;
# –ê–Ω–∞–ª–∏–∑ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤;
# –û—Ü–µ–Ω–∫–∞ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏ —Ä–µ–∫–ª–∞–º—ã.

# <div class="alert alert-block alert-success">‚úîÔ∏è
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ2__
# 
# –°—É–ø–µ—Ä, —Å—Ç–∞—Ä–∞–π—Å—è, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è —ç—Ç–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤ –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö =)
# </div>

# ### –ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –∏—Ö –∫ –∞–Ω–∞–ª–∏–∑—É

# –ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –æ –≤–∏–∑–∏—Ç–∞—Ö, –∑–∞–∫–∞–∑–∞—Ö –∏ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–∞—Ö –∏–∑ CSV-—Ñ–∞–π–ª–æ–≤ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ.
# 
# **–ü—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º**
# 
# - –≤–∏–∑–∏—Ç—ã: `/datasets/visits_info_short.csv`.¬†[–°–∫–∞—á–∞—Ç—å –¥–∞—Ç–∞—Å–µ—Ç](https://code.s3.yandex.net/datasets/visits_info_short.csv);
# - –∑–∞–∫–∞–∑—ã: `/datasets/orders_info_short.csv`.¬†[–°–∫–∞—á–∞—Ç—å –¥–∞—Ç–∞—Å–µ—Ç](https://code.s3.yandex.net/datasets/orders_info_short.csv);
# - —Ä–∞—Å—Ö–æ–¥—ã: `/datasets/costs_info_short.csv`.¬†[–°–∫–∞—á–∞—Ç—å –¥–∞—Ç–∞—Å–µ—Ç](https://code.s3.yandex.net/datasets/costs_info_short.csv).
# 
# –ò–∑—É—á–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫—É. –ï—Å—Ç—å –ª–∏ –≤ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–ø—É—Å–∫–∏ –∏ –¥—É–±–ª–∏–∫–∞—Ç—ã? –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –≤–æ –≤—Å–µ—Ö –∫–æ–ª–æ–Ω–∫–∞—Ö¬†—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º –≤ –Ω–∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è–º. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Å—Ç–æ–ª–±—Ü—ã —Å –¥–∞—Ç–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º.

# –∏–º–ø–æ—Ä—Ç

# In[1]:


import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt
from datetime import datetime, timedelta


# —Å—á–∏—Ç—ã–≤–∞–µ–º —Ñ–∞–π–ª—ã

# In[2]:


visits = pd.read_csv('/datasets/visits_info_short.csv')
orders = pd.read_csv('/datasets/orders_info_short.csv')
costs = pd.read_csv('/datasets/costs_info_short.csv')


# <div class="alert alert-block alert-success">‚úîÔ∏è
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ1__
#         
# –î–ª—è –ø–æ–¥–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—é `try-except`, –æ–Ω–∞ –ø–æ–º–æ–∂–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—É—Ç–µ–π.
#         
# –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Å—Å—ã–ª–∫–µ:
#         
# https://pythonworld.ru/tipy-dannyx-v-python/isklyucheniya-v-python-konstrukciya-try-except-dlya-obrabotki-isklyuchenij.html
#         
# –õ–∏–±–æ –∂–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É os:
#         
# https://pythonworld.ru/moduli/modul-os.html
# 
#     
# –ù–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π –∫–µ–π—Å—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:
#     
# https://www.programiz.com/python-programming/exception-handling
#     
# https://towardsdatascience.com/do-not-abuse-try-except-in-python-d9b8ee59e23b
#     
# https://www.techbeamers.com/use-try-except-python/
#         
# –ö–∞–∫ –≤–∞—Ä–∏–∞–Ω—Ç –≤ try –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—É—Ç–∏ (–≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ) –≤ except - –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ (–ª–æ–∫–∞–ª—å–Ω—ã–µ). –ú–æ–∂–Ω–æ —Ç–∞–∫–∂–µ —Å–ø–µ—Ü–∏—Ñ–∏—Ü—Ä–æ–≤–∞—Ç—å —Ç–∏–ø –æ—à–∏–±–∫–∏, FileNotFoundError –∏–ª–∏ –∑–∞–¥–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–π —Ç–∏–ø –æ—à–∏–±–∫–∏ (FilePathError, –Ω–∞–ø—Ä–∏–º–µ—Ä)
#         
# –û–Ω–∞ –ø–æ–ª–µ–∑–Ω–∞, –µ—Å–ª–∏ —Ç—ã —Ä–∞–±–æ—Ç–∞–µ—à—å –ª–æ–∫–∞–ª—å–Ω–æ, –∞ –ø–æ—Ç–æ–º –ø–æ–¥–≥—Ä—É–∂–∞–µ—à—å –ø—Ä–æ–µ–∫—Ç –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É. –ö–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ–∑–≤–æ–ª–∏—Ç –Ω–µ –ø–∞–¥–∞—Ç—å –∫–æ–¥—É –∏ –ª–æ–∫–∞–ª—å–Ω–æ, –∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –Ø–ü, —Ç–∞–∫ –∫–∞–∫ –µ—Å–ª–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –æ–¥–∏–Ω –±–ª–æ–∫ —Å –ø—É—Ç—è–º–∏, —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –¥—Ä—É–≥–æ–π.
#         
# –ù—É –∏ –≤–æ–æ–±—â–µ, –≤ —Ü–µ–ª–æ–º –ø–æ–ª–µ–∑–Ω–æ –ø—Ä–æ —ç—Ç—É –∫–æ–Ω—Å—Ç—É—Ä–∫—Ü–∏—é –∑–Ω–∞—Ç—å, –æ–Ω–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞ –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –≤ —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö.

# –°–º–æ—Ç—Ä–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –∫–∞–∂–¥–æ–º—É –¥–∞—Ç–∞—Å–µ—Ç—É

# In[3]:


visits.info()


# In[4]:


orders.info()


# In[5]:


costs.info()


# –í—ã–≤–æ–¥–∏–º –ø–µ—Ä–≤—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–æ–≤–≤

# In[6]:


visits.head(5)


# In[7]:


orders.head(5)


# In[8]:


costs.head(5)


# In[9]:


visits.isna().sum()


# In[10]:


orders.isna().sum()


# In[11]:


costs.isna().sum()


# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

# In[12]:


visits.duplicated().sum()


# In[13]:


orders.duplicated().sum()


# In[14]:


costs.duplicated().sum()


# In[15]:


visits.columns = [x.lower().replace(' ', '_') for x in visits.columns.values]


# In[16]:


orders.columns = [x.lower().replace(' ', '_') for x in orders.columns.values]


# In[17]:


costs.columns = [x.lower().replace(' ', '_') for x in costs.columns.values]


# In[18]:


visits.info()


# In[19]:


orders.info()


# In[20]:


costs.info()


# In[21]:


visits['session_end'] = pd.to_datetime(visits['session_end'], format = '%Y-%m-%d %H:%M:%S')
visits['session_start'] = pd.to_datetime(visits['session_start'], format = '%Y-%m-%d %H:%M:%S')


# In[22]:


orders['event_dt'] = pd.to_datetime(orders['event_dt'], format = '%Y-%m-%d %H:%M:%S')


# In[23]:


costs['dt'] = pd.to_datetime(costs['dt'], format="%Y-%m-%d")


# In[24]:


visits.describe()


# In[25]:


orders.describe()


# In[26]:


costs.describe()


# –û–∑–Ω–∞–∫–æ–º–∏–ª—Å—è —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏. –ü—Ä–æ–ø—É—Å–∫–æ–≤ –∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –Ω–µ—Ç. –ë—ã–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–∏–ø–æ–º –¥–∞–Ω–Ω—ã—Ö, –ø–æ–º–µ–Ω—è–ª –Ω–∞ –Ω—É–∂–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç

# <div class="alert alert-block alert-danger">‚úç
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ1__
# 
# –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã –∏ –ø—Ä–æ–ø—É—Å–∫–∏. –¢–∞–∫ –∂–µ –Ω–µ—Ç—É –≤—ã–≤–æ–¥–∞ –æ –∫–∞—á–µ—Å—Ç–≤–µ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–∞–≤–∏—à—å, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞?
# </div>

# <div class="alert alert-block alert-success">‚úîÔ∏è
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ2__
# 
#     
# –•–æ—Ä–æ—à–æ, –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–¥–µ–ª–∞–Ω—ã
# </div>

# <div class="alert alert-block alert-warning">üìù
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ1__
# 
# 
#     
# * –Ω–∞ —Å—Ç–∞–¥–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∫ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º—É –∞–Ω–∞–ª–∏–∑—É, —Å–æ–≤–µ—Ç—É—é –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –¥–∞–Ω–Ω—ã–µ –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –Ω–µ–≤—ã–Ω—É–∂–¥–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫ –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º. –ß–µ–º –±–æ–ª—å—à–µ–º –º—ã –∑–Ω–∞–µ–º –æ –¥–∞–Ω–Ω—ã—Ö - —Ç–µ–º –±–æ–ª–µ–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã –∏ –æ–±–æ—Å–Ω–æ–≤–∞–Ω—ã –≤—ã–≥–ª—è–¥—è—Ç –Ω–∞—à–∏ –≤—ã–≤–æ–¥—ã. –¢–∞–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–µ –∑–∞–Ω–∏–º–∞—é—Ç, –Ω–æ –∑–∞—Ç–æ –º—ã –º–æ–∂–µ–º –ª—É—á—à–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –∏—Ö –∞–Ω–∞–ª–∏–∑. –ù–∞–ø—Ä–∏–º–µ—Ä, –º—ã –º–æ–∂–µ–º:
#     - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —É—Å–ª–æ–≤–∏—é –ø—Ä–æ–µ–∫—Ç–∞, –∞ —Ç–∞–∫–∂–µ –Ω–∞ –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ª—É—á–∞–∏, –∫–æ–≥–¥–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –±—ã–ª–æ —Ä–∞–Ω—å—à–µ, –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ);
#     - –¥–ª—è —á–∏—Å–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –∏—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Ö –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∫–∞–∫–∏—Ö-—Ç–æ –æ—à–∏–±–æ–∫ –∏–ª–∏ –∞–Ω–æ–º–∞–ª–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω—É–ª–∏ –∏–ª–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ç–∞–º, –≥–¥–µ –æ–Ω–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å).

# ### –ó–∞–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞ LTV, ROI, —É–¥–µ—Ä–∂–∞–Ω–∏—è –∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏.
# 
# –†–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –≤—ã –ø–æ–∑–Ω–∞–∫–æ–º–∏–ª–∏—Å—å –≤ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏—Ö —É—Ä–æ–∫–∞—Ö.
# 
# –≠—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π –º–µ—Ç—Ä–∏–∫:
# 
# - `get_profiles()` ‚Äî –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π,
# - `get_retention()` ‚Äî –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ Retention Rate,
# - `get_conversion()` ‚Äî –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏,
# - `get_ltv()` ‚Äî –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ LTV.
# 
# –ê —Ç–∞–∫–∂–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤:
# 
# - `filter_data()` ‚Äî –¥–ª—è —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö,
# - `plot_retention()` ‚Äî –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ Retention Rate,
# - `plot_conversion()` ‚Äî –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏,
# - `plot_ltv_roi` ‚Äî –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ LTV –∏ ROI.

# In[27]:


def get_profiles(sessions, orders, ad_costs):

    # —Å–æ—Ä—Ç–∏—Ä—É–µ–º —Å–µ—Å—Å–∏–∏ –ø–æ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –¥–∞—Ç–µ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è
    # –≥—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ ID –∏ –Ω–∞—Ö–æ–¥–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–≤—ã—Ö –ø–æ—Å–µ—â–µ–Ω–∏–π
    profiles = (
        sessions.sort_values(by=['user_id', 'session_start'])
        .groupby('user_id')
        .agg(
            {
                'session_start': 'first',
                'channel': 'first',
                'device': 'first',
                'region': 'first',
            }
        )
         # –≤—Ä–µ–º—è –ø–µ—Ä–≤–æ–≥–æ –ø–æ—Å–µ—â–µ–Ω–∏—è –Ω–∞–∑–æ–≤—ë–º first_ts
        .rename(columns={'session_start': 'first_ts'})
        .reset_index()  # –≤–æ–∑–≤—Ä–∞—â–∞–µ–º user_id –∏–∑ –∏–Ω–¥–µ–∫—Å–∞
    )

    # –¥–ª—è –∫–æ–≥–æ—Ä—Ç–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–∞—Ç—É –ø–µ—Ä–≤–æ–≥–æ –ø–æ—Å–µ—â–µ–Ω–∏—è
    # –∏ –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞, –≤ –∫–æ—Ç–æ—Ä—ã–π —ç—Ç–æ –ø–æ—Å–µ—â–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ
    profiles['dt'] = profiles['first_ts'].dt.date
    profiles['dt'] = pd.to_datetime(profiles['dt'], format="%Y-%m-%d")
    profiles['month'] = profiles['first_ts'].astype('datetime64[M]')

    # –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–∑–Ω–∞–∫ –ø–ª–∞—Ç—è—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    profiles['payer'] = profiles['user_id'].isin(orders['user_id'].unique())

    # —Å—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    # —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∏ –¥–∞—Ç–æ–π –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è
    new_users = (
        profiles.groupby(['dt', 'channel'])
        .agg({'user_id': 'nunique'})
         # —Å—Ç–æ–ª–±–µ—Ü —Å —á–∏—Å–ª–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞–∑–æ–≤—ë–º unique_users
        .rename(columns={'user_id': 'unique_users'})
        .reset_index()  # –≤–æ–∑–≤—Ä–∞—â–∞–µ–º dt –∏ channel –∏–∑ –∏–Ω–¥–µ–∫—Å–æ–≤
    )

    # –æ–±—ä–µ–¥–∏–Ω—è–µ–º —Ç—Ä–∞—Ç—ã –Ω–∞ —Ä–µ–∫–ª–∞–º—É –∏ —á–∏—Å–ª–æ –ø—Ä–∏–≤–ª–µ—á—ë–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    # –ø–æ –¥–∞—Ç–µ –∏ –∫–∞–Ω–∞–ª—É –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è
    ad_costs = ad_costs.merge(new_users, on=['dt', 'channel'], how='left')

    # –¥–µ–ª–∏–º —Ä–µ–∫–ª–∞–º–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —á–∏—Å–ª–æ –ø—Ä–∏–≤–ª–µ—á—ë–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    # —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–∏–º –≤ —Å—Ç–æ–ª–±–µ—Ü acquisition_cost (CAC)
    ad_costs['acquisition_cost'] = ad_costs['costs'] / ad_costs['unique_users']

    # –¥–æ–±–∞–≤–∏–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –≤ –ø—Ä–æ—Ñ–∏–ª–∏
    profiles = profiles.merge(
        ad_costs[['dt', 'channel', 'acquisition_cost']],
        on=['dt', 'channel'],
        how='left',
    )

    # –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ —Å–≤—è–∑–∞–Ω—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –æ —Ä–µ–∫–ª–∞–º–µ,
    # –ø–æ—ç—Ç–æ–º—É –≤ —Å—Ç–æ–ª–±—Ü–µ acquisition_cost —É –Ω–∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è NaN
    # –∑–∞–º–µ–Ω–∏–º –∏—Ö –Ω–∞ –Ω–æ–ª—å, –≤–µ–¥—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è —Ä–∞–≤–Ω–∞ –Ω—É–ª—é
    profiles['acquisition_cost'] = profiles['acquisition_cost'].fillna(0)

    return profiles  # –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ—Ñ–∏–ª–∏ —Å CAC


# In[28]:


def get_retention(
    profiles,
    sessions,
    observation_date,
    horizon_days,
    dimensions=[],
    ignore_horizon=False,
):

    # –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç–æ–ª–±–µ—Ü payer –≤ –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–π dimensions —Å–ø–∏—Å–æ–∫
    dimensions = ['payer'] + dimensions

    # –∏—Å–∫–ª—é—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –Ω–µ ¬´–¥–æ–∂–∏–≤—à–∏—Ö¬ª –¥–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞
    last_suitable_acquisition_date = observation_date
    if not ignore_horizon:
        last_suitable_acquisition_date = observation_date - timedelta(
            days=horizon_days - 1
        )
    result_raw = profiles.query('dt <= @last_suitable_acquisition_date')

    # —Å–æ–±–∏—Ä–∞–µ–º ¬´—Å—ã—Ä—ã–µ¬ª –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —É–¥–µ—Ä–∂–∞–Ω–∏—è
    result_raw = result_raw.merge(
        sessions[['user_id', 'session_start']], on='user_id', how='left'
    )
    result_raw['lifetime'] = (
        result_raw['session_start'] - result_raw['first_ts']
    ).dt.days

    # —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã –ø–æ –∂–µ–ª–∞–µ–º—ã–º –ø—Ä–∏–∑–Ω–∞–∫–∞–º
    def group_by_dimensions(df, dims, horizon_days):
        result = df.pivot_table(
            index=dims, columns='lifetime', values='user_id', aggfunc='nunique'
        )
        cohort_sizes = (
            df.groupby(dims)
            .agg({'user_id': 'nunique'})
            .rename(columns={'user_id': 'cohort_size'})
        )
        result = cohort_sizes.merge(result, on=dims, how='left').fillna(0)
        result = result.div(result['cohort_size'], axis=0)
        result = result[['cohort_size'] + list(range(horizon_days))]
        result['cohort_size'] = cohort_sizes
        return result

    # –ø–æ–ª—É—á–∞–µ–º —Ç–∞–±–ª–∏—Ü—É —É–¥–µ—Ä–∂–∞–Ω–∏—è
    result_grouped = group_by_dimensions(result_raw, dimensions, horizon_days)

    # –ø–æ–ª—É—á–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–∏–Ω–∞–º–∏–∫–∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è
    result_in_time = group_by_dimensions(
        result_raw, dimensions + ['dt'], horizon_days
    )

    # –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±–µ —Ç–∞–±–ª–∏—Ü—ã –∏ —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
    return result_raw, result_grouped, result_in_time


# In[29]:


def get_conversion(
    profiles,
    purchases,
    observation_date,
    horizon_days,
    dimensions=[],
    ignore_horizon=False,
):

    # –∏—Å–∫–ª—é—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –Ω–µ ¬´–¥–æ–∂–∏–≤—à–∏—Ö¬ª –¥–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞
    last_suitable_acquisition_date = observation_date
    if not ignore_horizon:
        last_suitable_acquisition_date = observation_date - timedelta(
            days=horizon_days - 1
        )
    result_raw = profiles.query('dt <= @last_suitable_acquisition_date')

    # –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –ø–µ—Ä–≤–æ–π –ø–æ–∫—É–ø–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    first_purchases = (
        purchases.sort_values(by=['user_id', 'event_dt'])
        .groupby('user_id')
        .agg({'event_dt': 'first'})
        .reset_index()
    )

    # –¥–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–∫—É–ø–∫–∞—Ö –≤ –ø—Ä–æ—Ñ–∏–ª–∏
    result_raw = result_raw.merge(
        first_purchases[['user_id', 'event_dt']], on='user_id', how='left'
    )

    # —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ª–∞–π—Ñ—Ç–∞–π–º –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–∫—É–ø–∫–∏
    result_raw['lifetime'] = (
        result_raw['event_dt'] - result_raw['first_ts']
    ).dt.days

    # –≥—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ cohort, –µ—Å–ª–∏ –≤ dimensions –Ω–∏—á–µ–≥–æ –Ω–µ—Ç
    if len(dimensions) == 0:
        result_raw['cohort'] = 'All users'
        dimensions = dimensions + ['cohort']


# In[30]:


# —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è —Ñ—Ä–µ–π–º–∞

def filter_data(df, window):
    # –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ –ø—Ä–∏–º–µ–Ω—è–µ–º —Å–∫–æ–ª—å–∑—è—â–µ–µ —Å—Ä–µ–¥–Ω–µ–µ
    for column in df.columns.values:
        df[column] = df[column].rolling(window).mean() 
    return df


# In[31]:


def plot_retention(retention, retention_history, horizon, window=7):

    # –∑–∞–¥–∞—ë–º —Ä–∞–∑–º–µ—Ä —Å–µ—Ç–∫–∏ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
    plt.figure(figsize=(15, 10))

    # –∏—Å–∫–ª—é—á–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –∫–æ–≥–æ—Ä—Ç –∏ —É–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è
    retention = retention.drop(columns=['cohort_size', 0])
    # –≤ —Ç–∞–±–ª–∏—Ü–µ –¥–∏–Ω–∞–º–∏–∫–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–π –ª–∞–π—Ñ—Ç–∞–π–º
    retention_history = retention_history.drop(columns=['cohort_size'])[
        [horizon - 1]
    ]

    # –µ—Å–ª–∏ –≤ –∏–Ω–¥–µ–∫—Å–∞—Ö —Ç–∞–±–ª–∏—Ü—ã —É–¥–µ—Ä–∂–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ payer,
    # –¥–æ–±–∞–≤–ª—è–µ–º –≤—Ç–æ—Ä–æ–π –ø—Ä–∏–∑–Ω–∞–∫ ‚Äî cohort
    if retention.index.nlevels == 1:
        retention['cohort'] = 'All users'
        retention = retention.reset_index().set_index(['cohort', 'payer'])

    # –≤ —Ç–∞–±–ª–∏—Ü–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤ ‚Äî –¥–≤–∞ —Å—Ç–æ–ª–±—Ü–∞ –∏ –¥–≤–µ —Å—Ç—Ä–æ–∫–∏, —á–µ—Ç—ã—Ä–µ —è—á–µ–π–∫–∏
    # –≤ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∏–º –∫—Ä–∏–≤—ã–µ —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø–ª–∞—Ç—è—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    ax1 = plt.subplot(2, 2, 1)
    retention.query('payer == True').droplevel('payer').T.plot(
        grid=True, ax=ax1
    )
    plt.legend()
    plt.xlabel('–õ–∞–π—Ñ—Ç–∞–π–º')
    plt.title('–£–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–ª–∞—Ç—è—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π')

    # –≤–æ –≤—Ç–æ—Ä–æ–π —è—á–µ–π–∫–µ —Å—Ç—Ä–æ–∏–º –∫—Ä–∏–≤—ã–µ —É–¥–µ—Ä–∂–∞–Ω–∏—è –Ω–µ–ø–ª–∞—Ç—è—â–∏—Ö
    # –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –æ—Å—å ‚Äî –æ—Ç –≥—Ä–∞—Ñ–∏–∫–∞ –∏–∑ –ø–µ—Ä–≤–æ–π —è—á–µ–π–∫–∏
    ax2 = plt.subplot(2, 2, 2, sharey=ax1)
    retention.query('payer == False').droplevel('payer').T.plot(
        grid=True, ax=ax2
    )
    plt.legend()
    plt.xlabel('–õ–∞–π—Ñ—Ç–∞–π–º')
    plt.title('–£–¥–µ—Ä–∂–∞–Ω–∏–µ –Ω–µ–ø–ª–∞—Ç—è—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π')

    # –≤ —Ç—Ä–µ—Ç—å–µ–π —è—á–µ–π–∫–µ ‚Äî –¥–∏–Ω–∞–º–∏–∫–∞ —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø–ª–∞—Ç—è—â–∏—Ö
    ax3 = plt.subplot(2, 2, 3)
    # –ø–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏—è —Å—Ç–æ–ª–±—Ü–æ–≤ –¥–ª—è —Å–≤–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
    columns = [
        name
        for name in retention_history.index.names
        if name not in ['dt', 'payer']
    ]
    # —Ñ–∏–ª—å—Ç—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏ —Å—Ç—Ä–æ–∏–º –≥—Ä–∞—Ñ–∏–∫
    filtered_data = retention_history.query('payer == True').pivot_table(
        index='dt', columns=columns, values=horizon - 1, aggfunc='mean'
    )
    filter_data(filtered_data, window).plot(grid=True, ax=ax3)
    plt.xlabel('–î–∞—Ç–∞ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è')
    plt.title(
        '–î–∏–Ω–∞–º–∏–∫–∞ —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø–ª–∞—Ç—è—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ {}-–π –¥–µ–Ω—å'.format(
            horizon
        )
    )

    # –≤ —á—ë—Ç–≤–µ—Ä—Ç–æ–π —è—á–µ–π–∫–µ ‚Äî –¥–∏–Ω–∞–º–∏–∫–∞ —É–¥–µ—Ä–∂–∞–Ω–∏—è –Ω–µ–ø–ª–∞—Ç—è—â–∏—Ö
    ax4 = plt.subplot(2, 2, 4, sharey=ax3)
    # —Ñ–∏–ª—å—Ç—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏ —Å—Ç—Ä–æ–∏–º –≥—Ä–∞—Ñ–∏–∫
    filtered_data = retention_history.query('payer == False').pivot_table(
        index='dt', columns=columns, values=horizon - 1, aggfunc='mean'
    )
    filter_data(filtered_data, window).plot(grid=True, ax=ax4)
    plt.xlabel('–î–∞—Ç–∞ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è')
    plt.title(
        '–î–∏–Ω–∞–º–∏–∫–∞ —É–¥–µ—Ä–∂–∞–Ω–∏—è –Ω–µ–ø–ª–∞—Ç—è—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ {}-–π –¥–µ–Ω—å'.format(
            horizon
        )
    )
    
    plt.tight_layout()
    plt.show()


# In[32]:


def get_conversion(
    profiles,
    purchases,
    observation_date,
    horizon_days,
    dimensions=[],
    ignore_horizon=False,
):

    # –∏—Å–∫–ª—é—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –Ω–µ ¬´–¥–æ–∂–∏–≤—à–∏—Ö¬ª –¥–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞
    last_suitable_acquisition_date = observation_date
    if not ignore_horizon:
        last_suitable_acquisition_date = observation_date - timedelta(
            days=horizon_days - 1
        )
    result_raw = profiles.query('dt <= @last_suitable_acquisition_date')

    # –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –ø–µ—Ä–≤–æ–π –ø–æ–∫—É–ø–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    first_purchases = (
        purchases.sort_values(by=['user_id', 'event_dt'])
        .groupby('user_id')
        .agg({'event_dt': 'first'})
        .reset_index()
    )

    # –¥–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–∫—É–ø–∫–∞—Ö –≤ –ø—Ä–æ—Ñ–∏–ª–∏
    result_raw = result_raw.merge(
        first_purchases[['user_id', 'event_dt']], on='user_id', how='left'
    )

    # —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ª–∞–π—Ñ—Ç–∞–π–º –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–∫—É–ø–∫–∏
    result_raw['lifetime'] = (
        result_raw['event_dt'] - result_raw['first_ts']
    ).dt.days

    # –≥—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ cohort, –µ—Å–ª–∏ –≤ dimensions –Ω–∏—á–µ–≥–æ –Ω–µ—Ç
    if len(dimensions) == 0:
        result_raw['cohort'] = 'All users' 
        dimensions = dimensions + ['cohort']

    # —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã –ø–æ –∂–µ–ª–∞–µ–º—ã–º –ø—Ä–∏–∑–Ω–∞–∫–∞–º
    def group_by_dimensions(df, dims, horizon_days):
        result = df.pivot_table(
            index=dims, columns='lifetime', values='user_id', aggfunc='nunique'
        )
        result = result.fillna(0).cumsum(axis = 1)
        cohort_sizes = (
            df.groupby(dims)
            .agg({'user_id': 'nunique'})
            .rename(columns={'user_id': 'cohort_size'})
        )
        result = cohort_sizes.merge(result, on=dims, how='left').fillna(0)
        # –¥–µ–ª–∏–º –∫–∞–∂–¥—É—é ¬´—è—á–µ–π–∫—É¬ª –≤ —Å—Ç—Ä–æ–∫–µ –Ω–∞ —Ä–∞–∑–º–µ—Ä –∫–æ–≥–æ—Ä—Ç—ã
        # –∏ –ø–æ–ª—É—á–∞–µ–º conversion rate
        result = result.div(result['cohort_size'], axis=0)
        result = result[['cohort_size'] + list(range(horizon_days))]
        result['cohort_size'] = cohort_sizes
        return result

    # –ø–æ–ª—É—á–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
    result_grouped = group_by_dimensions(result_raw, dimensions, horizon_days)

    # –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –¥–∏–Ω–∞–º–∏–∫–∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ —É–±–∏—Ä–∞–µ–º 'cohort' –∏–∑ dimensions
    if 'cohort' in dimensions: 
        dimensions = []

    # –ø–æ–ª—É—á–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–∏–Ω–∞–º–∏–∫–∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
    result_in_time = group_by_dimensions(
        result_raw, dimensions + ['dt'], horizon_days
    )

    # –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±–µ —Ç–∞–±–ª–∏—Ü—ã –∏ —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
    return result_raw, result_grouped, result_in_time


# In[33]:


def plot_ltv_roi(ltv, ltv_history, roi, roi_history, horizon, window=7):

    # –∑–∞–¥–∞—ë–º —Å–µ—Ç–∫—É –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –≥—Ä–∞—Ñ–∏–∫–æ–≤
    plt.figure(figsize=(20, 20))

    # –∏–∑ —Ç–∞–±–ª–∏—Ü—ã ltv –∏—Å–∫–ª—é—á–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –∫–æ–≥–æ—Ä—Ç
    ltv = ltv.drop(columns=['cohort_size'])
    # –≤ —Ç–∞–±–ª–∏—Ü–µ –¥–∏–Ω–∞–º–∏–∫–∏ ltv –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–π –ª–∞–π—Ñ—Ç–∞–π–º
    ltv_history = ltv_history.drop(columns=['cohort_size'])[[horizon - 1]]

    # —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –∑–∞–ø–∏—à–µ–º –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ—Ä–µ–π–º
    cac_history = roi_history[['cac']]

    # –∏–∑ —Ç–∞–±–ª–∏—Ü—ã roi –∏—Å–∫–ª—é—á–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –∫–æ–≥–æ—Ä—Ç –∏ cac
    roi = roi.drop(columns=['cohort_size', 'cac'])
    # –≤ —Ç–∞–±–ª–∏—Ü–µ –¥–∏–Ω–∞–º–∏–∫–∏ roi –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–π –ª–∞–π—Ñ—Ç–∞–π–º
    roi_history = roi_history.drop(columns=['cohort_size', 'cac'])[
        [horizon - 1]
    ]

    # –ø–µ—Ä–≤—ã–π –≥—Ä–∞—Ñ–∏–∫ ‚Äî –∫—Ä–∏–≤—ã–µ ltv
    ax1 = plt.subplot(3, 2, 1)
    ltv.T.plot(grid=True, ax=ax1)
    plt.legend()
    plt.xlabel('–õ–∞–π—Ñ—Ç–∞–π–º')
    plt.title('LTV')

    # –≤—Ç–æ—Ä–æ–π –≥—Ä–∞—Ñ–∏–∫ ‚Äî –¥–∏–Ω–∞–º–∏–∫–∞ ltv
    ax2 = plt.subplot(3, 2, 2, sharey=ax1)
    # —Å—Ç–æ–ª–±—Ü–∞–º–∏ —Å–≤–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã —Å—Ç–∞–Ω—É—Ç –≤—Å–µ —Å—Ç–æ–ª–±—Ü—ã –∏–Ω–¥–µ–∫—Å–∞, –∫—Ä–æ–º–µ –¥–∞—Ç—ã
    columns = [name for name in ltv_history.index.names if name not in ['dt']]
    filtered_data = ltv_history.pivot_table(
        index='dt', columns=columns, values=horizon - 1, aggfunc='mean'
    )
    filter_data(filtered_data, window).plot(grid=True, ax=ax2)
    plt.xlabel('–î–∞—Ç–∞ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è')
    plt.title('–î–∏–Ω–∞–º–∏–∫–∞ LTV –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ {}-–π –¥–µ–Ω—å'.format(horizon))

    # —Ç—Ä–µ—Ç–∏–π –≥—Ä–∞—Ñ–∏–∫ ‚Äî –¥–∏–Ω–∞–º–∏–∫–∞ cac
    ax3 = plt.subplot(3, 2, 3, sharey=ax1)
    # —Å—Ç–æ–ª–±—Ü–∞–º–∏ —Å–≤–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã —Å—Ç–∞–Ω—É—Ç –≤—Å–µ —Å—Ç–æ–ª–±—Ü—ã –∏–Ω–¥–µ–∫—Å–∞, –∫—Ä–æ–º–µ –¥–∞—Ç—ã
    columns = [name for name in cac_history.index.names if name not in ['dt']]
    filtered_data = cac_history.pivot_table(
        index='dt', columns=columns, values='cac', aggfunc='mean'
    )
    filter_data(filtered_data, window).plot(grid=True, ax=ax3)
    plt.xlabel('–î–∞—Ç–∞ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è')
    plt.title('–î–∏–Ω–∞–º–∏–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π')

    # —á–µ—Ç–≤—ë—Ä—Ç—ã–π –≥—Ä–∞—Ñ–∏–∫ ‚Äî –∫—Ä–∏–≤—ã–µ roi
    ax4 = plt.subplot(3, 2, 4)
    roi.T.plot(grid=True, ax=ax4)
    plt.axhline(y=1, color='red', linestyle='--', label='–£—Ä–æ–≤–µ–Ω—å –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏')
    plt.legend()
    plt.xlabel('–õ–∞–π—Ñ—Ç–∞–π–º')
    plt.title('ROI')

    # –ø—è—Ç—ã–π –≥—Ä–∞—Ñ–∏–∫ ‚Äî –¥–∏–Ω–∞–º–∏–∫–∞ roi
    ax5 = plt.subplot(3, 2, 5, sharey=ax4)
    # —Å—Ç–æ–ª–±—Ü–∞–º–∏ —Å–≤–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã —Å—Ç–∞–Ω—É—Ç –≤—Å–µ —Å—Ç–æ–ª–±—Ü—ã –∏–Ω–¥–µ–∫—Å–∞, –∫—Ä–æ–º–µ –¥–∞—Ç—ã
    columns = [name for name in roi_history.index.names if name not in ['dt']]
    filtered_data = roi_history.pivot_table(
        index='dt', columns=columns, values=horizon - 1, aggfunc='mean'
    )
    filter_data(filtered_data, window).plot(grid=True, ax=ax5)
    plt.axhline(y=1, color='red', linestyle='--', label='–£—Ä–æ–≤–µ–Ω—å –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏')
    plt.xlabel('–î–∞—Ç–∞ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è')
    plt.title('–î–∏–Ω–∞–º–∏–∫–∞ ROI –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ {}-–π –¥–µ–Ω—å'.format(horizon))

    plt.tight_layout()
    plt.show()


# In[34]:


def plot_conversion(conversion, conversion_history, horizon, window=7):

    # –∑–∞–¥–∞—ë–º —Ä–∞–∑–º–µ—Ä —Å–µ—Ç–∫–∏ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
    plt.figure(figsize=(15, 5))

    # –∏—Å–∫–ª—é—á–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –∫–æ–≥–æ—Ä—Ç
    conversion = conversion.drop(columns=['cohort_size'])
    # –≤ —Ç–∞–±–ª–∏—Ü–µ –¥–∏–Ω–∞–º–∏–∫–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–π –ª–∞–π—Ñ—Ç–∞–π–º
    conversion_history = conversion_history.drop(columns=['cohort_size'])[
        [horizon - 1]
    ]

    # –ø–µ—Ä–≤—ã–π –≥—Ä–∞—Ñ–∏–∫ ‚Äî –∫—Ä–∏–≤—ã–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
    ax1 = plt.subplot(1, 2, 1)
    conversion.T.plot(grid=True, ax=ax1)
    plt.legend()
    plt.xlabel('–õ–∞–π—Ñ—Ç–∞–π–º')
    plt.title('–ö–æ–Ω–≤–µ—Ä—Å–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π')

    # –≤—Ç–æ—Ä–æ–π –≥—Ä–∞—Ñ–∏–∫ ‚Äî –¥–∏–Ω–∞–º–∏–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
    ax2 = plt.subplot(1, 2, 2, sharey=ax1)
    columns = [		
        # —Å—Ç–æ–ª–±—Ü–∞–º–∏ —Å–≤–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã —Å—Ç–∞–Ω—É—Ç –≤—Å–µ —Å—Ç–æ–ª–±—Ü—ã –∏–Ω–¥–µ–∫—Å–∞, –∫—Ä–æ–º–µ –¥–∞—Ç—ã
        name for name in conversion_history.index.names if name not in ['dt']
    ]
    filtered_data = conversion_history.pivot_table(
        index='dt', columns=columns, values=horizon - 1, aggfunc='mean'
    )
    filter_data(filtered_data, window).plot(grid=True, ax=ax2)
    plt.xlabel('–î–∞—Ç–∞ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è')
    plt.title('–î–∏–Ω–∞–º–∏–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ {}-–π –¥–µ–Ω—å'.format(horizon))

    plt.tight_layout()
    plt.show()


# In[35]:


def get_ltv(
    profiles,
    purchases,
    observation_date,
    horizon_days,
    dimensions=[],
    ignore_horizon=False,
):

    # –∏—Å–∫–ª—é—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –Ω–µ ¬´–¥–æ–∂–∏–≤—à–∏—Ö¬ª –¥–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞
    last_suitable_acquisition_date = observation_date
    if not ignore_horizon:
        last_suitable_acquisition_date = observation_date - timedelta(
            days=horizon_days - 1
        )
    result_raw = profiles.query('dt <= @last_suitable_acquisition_date')
  
    # –¥–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–∫—É–ø–∫–∞—Ö –≤ –ø—Ä–æ—Ñ–∏–ª–∏
    result_raw = result_raw.merge(
        purchases[['user_id', 'event_dt', 'revenue']], on='user_id', how='left'
    )
    
    # —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ª–∞–π—Ñ—Ç–∞–π–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–∫—É–ø–∫–∏
    result_raw['lifetime'] = (
        result_raw['event_dt'] - result_raw['first_ts']
    ).dt.days
    
    # –≥—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ cohort, –µ—Å–ª–∏ –≤ dimensions –Ω–∏—á–µ–≥–æ –Ω–µ—Ç
    if len(dimensions) == 0:
        result_raw['cohort'] = 'All users'
        dimensions = dimensions + ['cohort']

    # —Ñ—É–Ω–∫—Ü–∏—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –ø–æ –∂–µ–ª–∞–µ–º—ã–º –ø—Ä–∏–∑–Ω–∞–∫–∞–º
    def group_by_dimensions(df, dims, horizon_days):
        # —Å—Ç—Ä–æ–∏–º ¬´—Ç—Ä–µ—É–≥–æ–ª—å–Ω—É—é¬ª —Ç–∞–±–ª–∏—Ü—É –≤—ã—Ä—É—á–∫–∏
        result = df.pivot_table(
            index=dims, columns='lifetime', values='revenue', aggfunc='sum'
        )
        # –Ω–∞—Ö–æ–¥–∏–º —Å—É–º–º—É –≤—ã—Ä—É—á–∫–∏ —Å –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ–º
        result = result.fillna(0).cumsum(axis=1)
        # –≤—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –∫–æ–≥–æ—Ä—Ç
        cohort_sizes = (
            df.groupby(dims)
            .agg({'user_id': 'nunique'})
            .rename(columns={'user_id': 'cohort_size'})
        )
        # –æ–±—ä–µ–¥–∏–Ω—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –∫–æ–≥–æ—Ä—Ç –∏ —Ç–∞–±–ª–∏—Ü—É –≤—ã—Ä—É—á–∫–∏
        result = cohort_sizes.merge(result, on=dims, how='left').fillna(0)
        # —Å—á–∏—Ç–∞–µ–º LTV: –¥–µ–ª–∏–º –∫–∞–∂–¥—É—é ¬´—è—á–µ–π–∫—É¬ª –≤ —Å—Ç—Ä–æ–∫–µ –Ω–∞ —Ä–∞–∑–º–µ—Ä –∫–æ–≥–æ—Ä—Ç—ã
        result = result.div(result['cohort_size'], axis=0)
        # –∏—Å–∫–ª—é—á–∞–µ–º –≤—Å–µ –ª–∞–π—Ñ—Ç–∞–π–º—ã, –ø—Ä–µ–≤—ã—à–∞—é—â–∏–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç –∞–Ω–∞–ª–∏–∑–∞
        result = result[['cohort_size'] + list(range(horizon_days))]
        # –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –∫–æ–≥–æ—Ä—Ç
        result['cohort_size'] = cohort_sizes

        # —Å–æ–±–∏—Ä–∞–µ–º –¥–∞—Ç–∞—Ñ—Ä–µ–π–º —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ CAC, 
        # –¥–æ–±–∞–≤–ª—è—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ dimensions
        cac = df[['user_id', 'acquisition_cost'] + dims].drop_duplicates()

        # —Å—á–∏—Ç–∞–µ–º —Å—Ä–µ–¥–Ω–∏–π CAC –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º –∏–∑ dimensions
        cac = (
            cac.groupby(dims)
            .agg({'acquisition_cost': 'mean'})
            .rename(columns={'acquisition_cost': 'cac'})
        )

        # —Å—á–∏—Ç–∞–µ–º ROI: –¥–µ–ª–∏–º LTV –Ω–∞ CAC
        roi = result.div(cac['cac'], axis=0)

        # —É–¥–∞–ª—è–µ–º —Å—Ç—Ä–æ–∫–∏ —Å –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–º ROI
        roi = roi[~roi['cohort_size'].isin([np.inf])]

        # –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –∫–æ–≥–æ—Ä—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ ROI
        roi['cohort_size'] = cohort_sizes

        # –¥–æ–±–∞–≤–ª—è–µ–º CAC –≤ —Ç–∞–±–ª–∏—Ü—É ROI
        roi['cac'] = cac['cac']

        # –≤ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ –æ—Å—Ç–∞–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –∫–æ–≥–æ—Ä—Ç, CAC
        # –∏ ROI –≤ –ª–∞–π—Ñ—Ç–∞–π–º—ã, –Ω–µ –ø—Ä–µ–≤—ã—à–∞—é—â–∏–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç –∞–Ω–∞–ª–∏–∑–∞
        roi = roi[['cohort_size', 'cac'] + list(range(horizon_days))]

        # –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã LTV –∏ ROI
        return result, roi

    # –ø–æ–ª—É—á–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã LTV –∏ ROI
    result_grouped, roi_grouped = group_by_dimensions(
        result_raw, dimensions, horizon_days
    )

    # –¥–ª—è —Ç–∞–±–ª–∏—Ü –¥–∏–Ω–∞–º–∏–∫–∏ —É–±–∏—Ä–∞–µ–º 'cohort' –∏–∑ dimensions
    if 'cohort' in dimensions:
        dimensions = []

    # –ø–æ–ª—É—á–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã –¥–∏–Ω–∞–º–∏–∫–∏ LTV –∏ ROI
    result_in_time, roi_in_time = group_by_dimensions(
        result_raw, dimensions + ['dt'], horizon_days
    )

    return (
        result_raw,  # —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
        result_grouped,  # —Ç–∞–±–ª–∏—Ü–∞ LTV
        result_in_time,  # —Ç–∞–±–ª–∏—Ü–∞ –¥–∏–Ω–∞–º–∏–∫–∏ LTV
        roi_grouped,  # —Ç–∞–±–ª–∏—Ü–∞ ROI
        roi_in_time,  # —Ç–∞–±–ª–∏—Ü–∞ –¥–∏–Ω–∞–º–∏–∫–∏ ROI
    )


# <div class="alert alert-block alert-success">‚úîÔ∏è
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ1__
#     
# –•–æ—Ä–æ—à–æ, –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±—ã–ª–∏ –∑–∞–¥–∞–Ω—ã, –º–æ–∂–Ω–æ –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ —Ä–∞—Å—á–µ—Ç–∞ –∏ –∞–Ω–∞–ª–∏–∑—ÉüëÄ

# ### –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö
# 
# - –°–æ—Å—Ç–∞–≤—å—Ç–µ –ø—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–∞—Ç—ã –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
# - –í—ã—è—Å–Ω–∏—Ç–µ, –∏–∑ –∫–∞–∫–∏—Ö —Å—Ç—Ä–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –Ω–∞ –∫–∞–∫—É—é —Å—Ç—Ä–∞–Ω—É –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –ø–ª–∞—Ç—è—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –ü–æ—Å—Ç—Ä–æ–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É, –æ—Ç—Ä–∞–∂–∞—é—â—É—é –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –¥–æ–ª—é –ø–ª–∞—Ç—è—â–∏—Ö –∏–∑ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω—ã.
# - –£–∑–Ω–∞–π—Ç–µ, –∫–∞–∫–∏–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ –ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—ã –∏ –∫–∞–∫–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é—Ç –ø–ª–∞—Ç—è—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏. –ü–æ—Å—Ç—Ä–æ–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É, –æ—Ç—Ä–∞–∂–∞—é—â—É—é –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –¥–æ–ª—é –ø–ª–∞—Ç—è—â–∏—Ö –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.
# - –ò–∑—É—á–∏—Ç–µ —Ä–µ–∫–ª–∞–º–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –∫–∞–Ω–∞–ª—ã, –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–∏—à–ª–æ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –ø–ª–∞—Ç—è—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –ü–æ—Å—Ç—Ä–æ–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É, –æ—Ç—Ä–∞–∂–∞—é—â—É—é –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –¥–æ–ª—é –ø–ª–∞—Ç—è—â–∏—Ö –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è.
# 
# –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –ø—É–Ω–∫—Ç–∞ —Å—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ –≤—ã–≤–æ–¥—ã.

# In[36]:


profiles = get_profiles(visits, orders, costs)
display(profiles.head(5)) 


# In[37]:


min_analysis_date = profiles['dt'].min()
observation_date = profiles['dt'].max()


# In[38]:


print(min_analysis_date, "\n", observation_date)


# <div class="alert alert-block alert-warning">üìù
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ1__
# 
# –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤—ã–≤–æ–¥, –∏–Ω–∞—á–µ –Ω–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è—Ç–Ω–æ, –∑–∞—á–µ–º –º—ã —Å–º–æ—Ç—Ä–µ–ª–∏ –Ω–∞ —ç—Ç–∏ –¥–∞—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é –ª–∏ –¥–∞—Ç—ã –¢–ó –∏–ª–∏ –Ω–µ—Ç).
# </div>

# In[39]:


region =  (profiles
           .pivot_table(
                        index='region',
                        columns='payer',
                        values='user_id',
                        aggfunc='count')
           .rename(columns={True: 'payer', False: 'not_payer'})
           .sort_values(by='payer', ascending=False)
          )


# In[40]:


fig, ax = plt.subplots(figsize=(18, 3))
region[['payer']].plot(kind='barh', stacked=True, ax=ax, alpha=0.4, color = 'maroon')
region[['not_payer']].plot(kind='barh', stacked=True, ax=ax, alpha=0.4, color = 'red')
ax.legend(bbox_to_anchor=(1.0, 1.0))
ax.set_xlabel('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π')
ax.set_ylabel(' ')
ax.set_title('–ü—Ä–∏–≤–ª–µ—á–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ —Ä–∞–∑—Ä–µ–∑–µ –ø–æ —Å—Ç—Ä–∞–Ω–∞–º',loc='left')
plt.show()

region['payer_share'] = (region.payer / (region.not_payer + region.payer) * 100).round(2)
region


# <div class="alert alert-block alert-success">‚úîÔ∏è
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ1__
# 
# –ó–¥–æ—Ä–æ–≤–æ, —á—Ç–æ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—à—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –≠—Ç–æ –≤–∞–∂–Ω—ã–π —Å–∫–∏–ª–ª –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤, —Ä–∞–∑–≤–∏–≤–∞–π –µ–≥–æ
# </div>

# In[41]:


device =  (profiles
           .pivot_table(
                        index='device',
                        columns='payer',
                        values='user_id',
                        aggfunc='count')
           .rename(columns={True: 'payer', False: 'not_payer'})
           .sort_values(by='payer', ascending=False)
          )


# In[42]:


fig, ax = plt.subplots(figsize=(18, 3))
device[['payer']].plot(kind='barh', stacked=True, ax=ax, alpha=0.4, color = 'maroon')
device[['not_payer']].plot(kind='barh', stacked=True, ax=ax, alpha=0.4, color = 'red')
ax.legend(bbox_to_anchor=(1.0, 1.0))
ax.set_xlabel('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π')
ax.set_ylabel(' ')
ax.set_title('–ü—Ä–∏–≤–ª–µ—á–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ —Ä–∞–∑—Ä–µ–∑–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤',loc='left')
plt.show()

device['payer_share'] = (device.payer / (device.not_payer + device.payer) * 100).round(2)
device


# In[43]:


channel =  (profiles
           .pivot_table(
                        index='channel',
                        columns='payer',
                        values='user_id',
                        aggfunc='count')
           .rename(columns={True: 'payer', False: 'not_payer'})
           .sort_values(by='payer', ascending=False)
          )


# In[44]:


fig, ax = plt.subplots(figsize=(18, 5))
channel[['payer']].plot(kind='barh', stacked=True, ax=ax, alpha=0.4, color = 'maroon')
channel[['not_payer']].plot(kind='barh', stacked=True, ax=ax, alpha=0.4, color = 'red')
ax.legend(bbox_to_anchor=(1.0, 1.0))
ax.set_xlabel('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π')
ax.set_ylabel(' ')
ax.set_title('–ü—Ä–∏–≤–ª–µ—á–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ —Ä–∞–∑—Ä–µ–∑–µ –∫–∞–Ω–∞–ª–æ–≤',loc='left')
plt.show()

channel['payer_share'] = (channel.payer / (channel.not_payer + channel.payer) * 100).round(2)
channel


# ### –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –≤—ã–≤–æ–¥—ã –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

#     –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 2019-05-01
#     –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 2019-10-27
#     –î–∞—Ç—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —É—Å–ª–æ–≤–∏—è–º –∑–∞–¥–∞–Ω–∏—è.
#     –í —Ä–∞–∑–±–∏–≤–∫–µ –ø–æ —Å—Ç—Ä–∞–Ω–∞–º –≤–∏–¥–Ω–æ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ä–æ—Å—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –°–®–ê, –æ–Ω–∏ –∂–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏ –Ω–∞ 14 –¥–µ–Ω—å –∏ –Ω–∞ –Ω–∏—Ö –∂–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π —Ä–æ—Å—Ç –≤ –¥–∏–Ω–∞–º–∏–∫–µ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏. –ü–æ –æ—Å—Ç–∞–ª—å–Ω—ã–º —Å—Ç—Ä–∞–Ω–∞–º —Å—Ç–æ–ª—å —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è, –≤—Å–µ –æ–Ω–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å
#    –°–∞–º—ã–µ –±–æ–ª—å—à–∏–µ –∑–∞—Ç—Ä–∞—Ç—ã -  –Ω–∞ —Ä–µ–∫–ª–∞–º—É –≤ TipTop –∏ FaceBoom, –ø—Ä–∏—á–µ–º —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ä–µ–∫–ª–∞–º—É –≤ TipTop –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ —É–≤–µ–ª–∏—á–∏–ª–∏—Å—å –∑–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º—ã–π –ø–µ—Ä–∏–æ–¥, —Ç–æ–≥–¥–∞ –∫–∞–∫ –Ω–∞ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã —Ç—Ä–∞—Ç—ã –ø–æ—á—Ç–∏ –Ω–µ –º–µ–Ω—è–ª–∏—Å—å. –¢–∞–∫–∂–µ —É TipTop –≤—ã—Ö–æ–¥–∏—Ç —Å–∞–º–∞—è –≤—ã—Å–æ–∫–∞—è —Ü–µ–Ω–∞ –∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–æ—á—Ç–∏ –≤ —Ç—Ä–∏ —Ä–∞–∑–∞ –±–æ–ª—å—à–µ —á–µ–º —É —Ç–æ–≥–æ –∂–µ FaceBoom.
#    –ö–ª–∏–µ–Ω—Ç—ã (–∫–∞–∫ –ø–ª–∞—Ç—è—â–∏–µ, —Ç–∞–∫ –∏ –Ω–µ –ø–ª–∞—Ç—è—â–∏–µ) –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é—Ç iOS, –æ–Ω–∏ –∂–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏ –Ω–∞ 14 –¥–µ–Ω—å, —Ç–æ–≥–¥–∞ –∫–∞–∫ –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤ –°–ê–° –Ω–∞–∏–º–µ–Ω—å—à–∏–π –∏ –Ω–∞–∏–±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–π ROI, –Ω–æ –≤ –¥–∏–Ω–∞–º–∏–∫–µ –≤–∏–¥–Ω–æ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Å–ø–∞–¥.
# 
# 
# 
# 

# <div class="alert alert-block alert-success">‚úîÔ∏è
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ1__
# 
# 
# –í —Ü–µ–ª–æ–º –≤ –¥–∞–Ω–Ω–æ–º —Ä–∞–∑–¥–µ–ª–µ –±—ã–ª –ø—Ä–æ–≤–µ–¥–µ–Ω —Ö–æ—Ä–æ—à–∏–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö - –º—ã –ø–æ—Å–º–æ—Ç—Ä–µ–ª–∏ –Ω–∞ –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ø–æ–∫—É–ø–∞—Ç–µ–ª–∏ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º, —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º –∏ –∫–∞–Ω–∞–ª—É –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è, –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π —Ä—ã–Ω–æ–∫. –ü–æ–ª—É—á–∞–µ—Ç—Å—è, —á—Ç–æ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –°–®–ê –∏ –æ–Ω–∏ –ª—É—á—à–µ –¥—Ä—É–≥–∏—Ö –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è. –ü—Ä–∏ —ç—Ç–æ–º –±–æ–ª—å—à–∞—è —á–∞—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞—Ö–æ–¥–∏—Ç —Å –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤, —ç—Ç–æ —Ç–æ–∂–µ —Å—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å. –¢–∞–∫–∂–µ, –º—ã –º–æ–∂–µ–º —Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ –Ω–∞–∏–±–æ–ª—å—à—É—é –∫–æ–Ω–≤–µ—Ä—Å–∏—é –∏–º–µ—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑—É—é—Ç—Å—è Mac, –∞ –∑–∞—Ç–µ–º —Å–ª–µ–¥—É—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ iPhone, —Ç.–µ. –º—ã –º–æ–∂–µ–º —Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ –≤ —Ü–µ–ª–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ Apple –∏–º–µ—é—Ç –ª—É—á—à—É—é –∫–æ–Ω–≤–µ—Ä—Å–∏—é –≤ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π. –í–æ–∑–º–æ–∂–Ω–æ, —Ç—É—Ç –µ—Å—Ç—å –ø–ª—é—Å—ã ApplePay.

# ### –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ 
# 
# 
# - –ü–æ—Å—á–∏—Ç–∞–π—Ç–µ –æ–±—â—É—é —Å—É–º–º—É —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥.
# - –í—ã—è—Å–Ω–∏—Ç–µ, –∫–∞–∫ —Ç—Ä–∞—Ç—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ —Ä–µ–∫–ª–∞–º–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º, —Ç–æ –µ—Å—Ç—å —Å–∫–æ–ª—å–∫–æ –¥–µ–Ω–µ–≥ –ø–æ—Ç—Ä–∞—Ç–∏–ª–∏ –Ω–∞ –∫–∞–∂–¥—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫.
# - –ü–æ—Å—Ç—Ä–æ–π—Ç–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –¥–∏–Ω–∞–º–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤ –≤–æ –≤—Ä–µ–º–µ–Ω–∏ (–ø–æ –Ω–µ–¥–µ–ª—è–º –∏ –º–µ—Å—è—Ü–∞–º) –ø–æ –∫–∞–∂–¥–æ–º—É –∏—Å—Ç–æ—á–Ω–∏–∫—É. –ü–æ—Å—Ç–∞—Ä–∞–π—Ç–µ—Å—å –æ—Ç—Ä–∞–∑–∏—Ç—å —ç—Ç–æ –Ω–∞ –æ–¥–Ω–æ–º –≥—Ä–∞—Ñ–∏–∫–µ.
# - –£–∑–Ω–∞–π—Ç–µ, —Å–∫–æ–ª—å–∫–æ –≤ —Å—Ä–µ–¥–Ω–µ–º —Å—Ç–æ–∏–ª–æ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (CAC) –∏–∑ –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
# 
# –ù–∞–ø–∏—à–∏—Ç–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –≤—ã–≤–æ–¥—ã.

# In[45]:


analysis_horizon = 14


# In[46]:


print(f'–û–±—â–∞—è —Å—É–º–º–∞ –∑–∞—Ç—Ä–∞—Ç –Ω–∞ —Ä–µ–∫–ª–∞–º—É: {costs.costs.sum().round()}')


# <div class="alert alert-block alert-success">‚úîÔ∏è
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ1__
# 
#         
# –ó–¥–æ—Ä–æ–≤–æ, —á—Ç–æ –æ–∫—Ä—É–≥–ª–∏–ª–∏

# In[47]:


costs.pivot_table(index='channel',values='costs',aggfunc='sum').sort_values(by='costs', ascending=False)


# In[48]:


fig, ax = plt.subplots(figsize=(16, 6))

(costs
 .pivot_table(
    index=costs.dt,
    values='costs',
    aggfunc='sum',
    columns='channel'
)
 .plot(ax=ax, stacked=True)
)

ax.set_title('–ó–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ä–∞–∑—Ä–µ–∑–µ –∫–∞–Ω–∞–ª–æ–≤', loc='left')
ax.set_ylabel('–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –≤ –¥–µ–Ω—å')
ax.set_xlabel(' ')
plt.show()


# In[49]:


# –ø–æ—Å—Ç—Ä–æ–∏–º –≥—Ä–∞—Ñ–∏–∫ –µ–∂–µ–º–µ—Å—è—á–Ω—ã—Ö –∑–∞—Ç—Ä–∞—Ç –ø–æ –∫–∞–Ω–∞–ª–∞–º

fig, ax = plt.subplots(figsize=(16, 6))

(costs
 .pivot_table(
    index=costs.dt.astype('datetime64[M]'),
    values='costs',
    aggfunc='sum',
    columns='channel'
)
 .plot(ax=ax, stacked=True)
)

ax.set_title('–ó–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ä–∞–∑—Ä–µ–∑–µ –∫–∞–Ω–∞–ª–æ–≤', loc='left')
ax.set_ylabel('–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –≤ –º–µ—Å—è—Ü')
ax.set_xlabel(' ')
plt.show()


# In[50]:


# –ø–æ—Å—Ç—Ä–æ–∏–º –≥—Ä–∞—Ñ–∏–∫ –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã—Ö –∑–∞—Ç—Ä–∞—Ç –ø–æ –∫–∞–Ω–∞–ª–∞–º

fig, ax = plt.subplots(figsize=(16, 6))

(costs
 .pivot_table(
    index=costs.dt.astype('datetime64[W]'),
    values='costs',
    aggfunc='sum',
    columns='channel'
)
 .plot(ax=ax, stacked=True)
)

ax.set_title('–ó–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ä–∞–∑—Ä–µ–∑–µ –∫–∞–Ω–∞–ª–æ–≤', loc='left')
ax.set_ylabel('–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –≤ –Ω–µ–¥–µ–ª—é')
ax.set_xlabel(' ')
plt.show()


# <div class="alert alert-block alert-danger">‚úç
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ1__
# 
# –ù–µ—Ç —Ä–µ—à–µ–Ω–∏—è –ø–æ –æ–¥–Ω–æ–º—É –∏–∑ –ø—É–Ω–∫—Ç–æ–≤ –∑–∞–¥–∞–Ω–∏—è (–∏–∑ –±—Ä–∏—Ñ–∞) - –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∏–Ω–∞–º–∏–∫—É —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ –∫–∞–Ω–∞–ª–∞–º.
#     
# –ü–æ  –º–µ—Å—è—Ü–∞–º (—Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ `df[''].astype('datetime64[M]')` –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –º–µ—Å—è—á–Ω–æ–π –¥–∞—Ç–µ.). –î–æ–±–∞–≤–∏—à—å, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞?
#     
# ---
#     
# –ê —Å –ø–æ–º–æ—â—å—é `[W]` - –Ω–µ–¥–µ–ª—å–Ω–æ–π
# </div>

# <div class="alert alert-block alert-success">‚úîÔ∏è
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ2__
# 
# –û—Ç–ª–∏—á–Ω—ã–µ –∏ –Ω–∞–≥–ª—è–¥–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ üëç
#     
# –ó–¥–æ—Ä–æ–≤–æ, –∫–æ–≥–¥–∞ –æ–Ω–∏ –ø–æ–¥–ø–∏—Å–∞–Ω—ã. –¢–∞–∫ –±—ã—Å—Ç—Ä–µ–µ –ø–æ–Ω—è—Ç—å –æ —á–µ–º –∏–¥—ë—Ç —Ä–µ—á—å –Ω–∞ –Ω—ë–º.
#     
# </div>

# In[ ]:





# In[51]:


cac_person = (profiles
              .query('channel != "organic"')[['user_id', 'acquisition_cost']]
              .drop_duplicates()
              .agg({'acquisition_cost': 'mean'})
             )
cac_person


# <div class="alert alert-block alert-success">‚úîÔ∏è
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ1__
# 
# –û—Ç–ª–∏—á–Ω—ã–π –∏–Ω—Å–∞–π–¥ –¥–ª—è –∑–∞–∫–∞–∑—á–∏–∫–∞) –ú–æ–ª–æ–¥–µ—Ü =)
# </div>

# In[52]:


cac_channel = (profiles
       .pivot_table(index = 'channel',
                    values = 'acquisition_cost',
                    aggfunc='mean')
       .sort_values(by='acquisition_cost', ascending=False)
       .rename(columns={'acquisition_cost': 'cac'})
      )
cac_channel


# ### –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –≤—ã–≤–æ–¥—ã –≤ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–µ
# 

# –û–±—â–∞—è —Å—É–º–º–∞ –∑–∞—Ç—Ä–∞—Ç –Ω–∞ —Ä–µ–∫–ª–∞–º—É: 105497.0
# –î–æ—Ä–æ–∂–µ –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –æ–±—Ö–æ–¥–∏—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä–æ–≥–æ –ø—Ä–∏–≤–ª–µ–∫–ª–∏ –ø—Ä–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º TipTop.

# <div class="alert alert-block alert-success">‚úîÔ∏è
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ1__
# 
# –ù–∞–∏–±–æ–ª–µ–µ –¥–æ—Ä–æ–≥–æ—Å—Ç–æ—è—â–∏–º –∫–∞–Ω–∞–ª–æ–º –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —è–≤–ª—è–µ—Ç—Å—è TipTop, –æ–¥–Ω–∞–∫–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ –¥–æ–ª—è –ø–ª–∞—Ç—è—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø—Ä–∏—Ö–æ–¥—è—â–∏—Ö —Å —ç—Ç–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞, –Ω–µ —Ç–∞–∫ –≤—ã—Å–æ–∫–∏. –≠—Ç–æ –º–æ–∂–Ω–æ –æ–±—ä—è—Å–Ω–∏—Ç—å –º–æ–ª–æ–¥–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–µ–π TipTop'a –∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –Ω–µ –æ—á–µ–Ω—å –≤—ã—Å–æ–∫–æ–π –∏—Ö –ø–ª–∞—Ç–µ–∂–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å—é.
#     
# </div>

# ### –û—Ü–µ–Ω–∏—Ç–µ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å —Ä–µ–∫–ª–∞–º—ã
# 
# –ò—Å–ø–æ–ª—å–∑—É—è –≥—Ä–∞—Ñ–∏–∫–∏ LTV, ROI –∏ CAC, –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å —Ä–µ–∫–ª–∞–º—ã. –°—á–∏—Ç–∞–π—Ç–µ, —á—Ç–æ –Ω–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ 1 –Ω–æ—è–±—Ä—è 2019 –≥–æ–¥–∞, –∞ –≤ –±–∏–∑–Ω–µ—Å-–ø–ª–∞–Ω–µ –∑–∞–ª–æ–∂–µ–Ω–æ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –æ–∫—É–ø–∞—Ç—å—Å—è –Ω–µ –ø–æ–∑–¥–Ω–µ–µ —á–µ–º —á–µ—Ä–µ–∑ –¥–≤–µ –Ω–µ–¥–µ–ª–∏ –ø–æ—Å–ª–µ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –≤–∫–ª—é—á–µ–Ω–∏—è –≤ –∞–Ω–∞–ª–∏–∑ –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.
# 
# - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å —Ä–µ–∫–ª–∞–º—ã c –ø–æ–º–æ—â—å—é –≥—Ä–∞—Ñ–∏–∫–æ–≤ LTV –∏ ROI, –∞ —Ç–∞–∫–∂–µ –≥—Ä–∞—Ñ–∏–∫–∏ –¥–∏–Ω–∞–º–∏–∫–∏ LTV, CAC –∏ ROI.
# - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω–≤–µ—Ä—Å–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –¥–∏–Ω–∞–º–∏–∫—É –µ—ë –∏–∑–º–µ–Ω–µ–Ω–∏—è. –¢–æ –∂–µ —Å–∞–º–æ–µ —Å–¥–µ–ª–∞–π—Ç–µ —Å —É–¥–µ—Ä–∂–∞–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –ü–æ—Å—Ç—Ä–æ–π—Ç–µ –∏ –∏–∑—É—á–∏—Ç–µ –≥—Ä–∞—Ñ–∏–∫–∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è.
# - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å —Ä–µ–∫–ª–∞–º—ã —Å —Ä–∞–∑–±–∏–≤–∫–æ–π –ø–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º. –ü–æ—Å—Ç—Ä–æ–π—Ç–µ –≥—Ä–∞—Ñ–∏–∫–∏ LTV –∏ ROI, –∞ —Ç–∞–∫–∂–µ –≥—Ä–∞—Ñ–∏–∫–∏ –¥–∏–Ω–∞–º–∏–∫–∏ LTV, CAC –∏ ROI.
# - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å —Ä–µ–∫–ª–∞–º—ã —Å —Ä–∞–∑–±–∏–≤–∫–æ–π –ø–æ —Å—Ç—Ä–∞–Ω–∞–º. –ü–æ—Å—Ç—Ä–æ–π—Ç–µ –≥—Ä–∞—Ñ–∏–∫–∏ LTV –∏ ROI, –∞ —Ç–∞–∫–∂–µ –≥—Ä–∞—Ñ–∏–∫–∏ –¥–∏–Ω–∞–º–∏–∫–∏ LTV, CAC –∏ ROI.
# - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å —Ä–µ–∫–ª–∞–º—ã —Å —Ä–∞–∑–±–∏–≤–∫–æ–π –ø–æ —Ä–µ–∫–ª–∞–º–Ω—ã–º –∫–∞–Ω–∞–ª–∞–º. –ü–æ—Å—Ç—Ä–æ–π—Ç–µ –≥—Ä–∞—Ñ–∏–∫–∏ LTV –∏ ROI, –∞ —Ç–∞–∫–∂–µ –≥—Ä–∞—Ñ–∏–∫–∏ –¥–∏–Ω–∞–º–∏–∫–∏ LTV, CAC –∏ ROI.
# - –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —Ç–∞–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã:
#     - –û–∫—É–ø–∞–µ—Ç—Å—è –ª–∏ —Ä–µ–∫–ª–∞–º–∞, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –Ω–∞ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ü–µ–ª–æ–º?
#     - –ö–∞–∫–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, —Å—Ç—Ä–∞–Ω—ã –∏ —Ä–µ–∫–ª–∞–º–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –º–æ–≥—É—Ç –æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å —Ä–µ–∫–ª–∞–º—ã?
#     - –ß–µ–º –º–æ–≥—É—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏?
# 
# –ù–∞–ø–∏—à–∏—Ç–µ –≤—ã–≤–æ–¥, –æ–ø–∏—à–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –∏ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–∞.

# In[53]:


profiles = profiles.query('channel != "organic"')


# <div class="alert alert-block alert-success">‚úîÔ∏è
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ1__
# 
# –°–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –≤–µ—Ä–Ω–æ, –ø–æ—Å–∫–æ–ª—å–∫—É –º—ã –∑–∞ –Ω–∏—Ö –Ω–∏—á–µ–≥–æ –Ω–µ –ø–ª–∞—Ç–∏–º,  –∞ –Ω–∞–º –Ω—É–∂–Ω–æ –∏–∑—É—á–∏—Ç—å –∏–º–µ–Ω–Ω–æ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å —Ä–µ–∫–ª–∞–º—ã. 
# </div>

# In[54]:


analysis_horizon = 14


# In[55]:


ltv_raw, ltv_grouped, ltv_history, roi_grouped, roi_history = get_ltv(
    profiles, orders, observation_date, analysis_horizon)

# —Å—Ç—Ä–æ–∏–º –≥—Ä–∞—Ñ–∏–∫–∏
plot_ltv_roi(ltv_grouped, ltv_history, roi_grouped, roi_history, analysis_horizon)


# –†–µ–∫–ª–∞–º–∞ –∫ 14-–º—É –¥–Ω—é –∏ –¥–∞–ª–µ–µ –Ω–µ –æ–∫—É–ø–∞–µ—Ç—Å—è;
# –°–ê–° —Ä–∞—Å—Ç–µ—Ç, –∑–Ω–∞—á–∏—Ç —Ä–µ–∫–ª–∞–º–Ω—ã–π –±—é–¥–∂–µ—Ç —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è;
# –ù–∞—á–∏–Ω–∞—è —Å –∏—é–Ω—è —á—Ç–æ-—Ç–æ –∏–¥–µ—Ç –Ω–µ —Ç–∞–∫: –ø—Ä–∏–≤–ª–µ—á–µ–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –ø–µ—Ä–µ—Å—Ç–∞—é—Ç –æ–∫—É–ø–∞—Ç—å—Å—è –≤ –¥–≤—É—Ö-–Ω–µ–¥–µ–ª—å–Ω–æ–º –ª–∞–π—Ñ—Ç–∞–π–º–µ

# <div class="alert alert-block alert-danger">‚úç
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ1__
# 
# –õ—É—á—à–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞, –≥—Ä–∞—Ñ–∏–∫–∞ (–∏–ª–∏ —Å–µ—Ä–∏–∏ —Ç–µ—Å—Ç–æ–≤) –ø–∏—Å–∞—Ç—å –≤—ã–≤–æ–¥ –ø–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º —Å —É—á–µ—Ç–æ–º –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π –±–∏–∑–Ω–µ—Å –∑–∞–¥–∞—á–∏ - —Ç–∞–∫ –ø—Ä–æ—â–µ —á–∏—Ç–∞—Ç—å –ø—Ä–æ–µ–∫—Ç, –ø–æ—Å–∫–æ–ª—å–∫—É –±—É–¥—É—â–∏–º –∫–æ–ª–ª–µ–≥–∞–º –∏–ª–∏ –∑–∞–∫–∞–∑—á–∏–∫—É –Ω–µ –Ω–∞–¥–æ –±—É–¥–µ—Ç —Å–∞–º–∏–º –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞, —Ç–µ—Å—Ç–∞ –∏–ª–∏ –≥—Ä–∞—Ñ–∏–∫–∞.

# <div class="alert alert-block alert-success">‚úîÔ∏è
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ2__
#     
# –õ–æ–≥–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –≤–µ—Ä–Ω–∞—è, —Å–æ–≥–ª–∞—Å–µ–Ω —Å –≤—ã–≤–æ–¥–æ–º. –ù–∞–±–ª—é–¥–∞–µ–º, —á—Ç–æ –¥–∏–Ω–∞–º–∏–∫–∞ ROI –∑–∞ –ª–∞–π—Ñ—Ç–∞–π–º –ø–∞–¥–∞–µ—Ç. –ü—Ä–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π –¥–∏–Ω–∞–º–∏–∫–µ LTV, –¥–∏–Ω–∞–º–∏–∫–∞ –°–ê–° —Ä–∞—Å—Ç—ë—Ç —Å –º–∞—è –ø–æ –∫–æ–Ω–µ—Ü –æ–∫—Ç—è–±—Ä—è. –≠—Ç—É –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç—å –º—ã –Ω–∞–±–ª—é–¥–∞–µ–º –≤ –¥–∏–Ω–∞–º–∏–∫–µ ROI, —á—Ç–æ –ø—Ä–∏ —Å–∏–ª—å–Ω–æ–º —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ –°–ê–°, –≤ —Ä–∞–≤–Ω–æ–π —Å—Ç–µ–ø–µ–Ω–∏ –ø–∞–¥–∞–µ—Ç –¥–∏–Ω–∞–º–∏–∫–∞ ROI –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
# </div>
# 

# –ö–∞–Ω–∞–ª—ã

# In[56]:


dimensions = ['channel']

ltv_raw, ltv_grouped, ltv_history, roi_grouped, roi_history = get_ltv(
    profiles, orders, observation_date, analysis_horizon, dimensions=dimensions
)

plot_ltv_roi(
    ltv_grouped, ltv_history, roi_grouped, roi_history, analysis_horizon, window=14
)


# –ó–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ä–µ–∫–ª–∞–º—É –≤ TipTop –∏ FaceBoom –≤–æ–æ–±—â–µ –Ω–µ –æ–∫—É–ø–∞—é—Ç—Å—è
# 
# –° –∑–∞—Ç—Ä–∞—Ç–∞–º–∏ –Ω–∞ —Ä–µ–∫–ª–∞–º—É TipTop —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç—Å—è –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü

# <div class="alert alert-block alert-danger">‚úç
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ2__
# 
# –í—ã–≤–æ–¥—ã?
# </div>

# <div class="alert alert-block alert-success">‚úîÔ∏è
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ3__
#     
# –î–∞, –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ, –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–∞–Ω–∞–ª–æ–º TipTop, –≤–∏–¥–∏–º –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π —Ä–æ—Å—Ç –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ.
# </div>

# In[57]:


(
    profiles
    .pivot_table(index='channel',
                 columns='region',
                 aggfunc={'user_id': 'count'}
                )
    .sort_values(by=('user_id', 'United States'), 
                 ascending=False)
).div(
    profiles
    .pivot_table(columns='region',
                 aggfunc={'user_id': 'count'}
                )
    .values
).fillna(0).style.format('{:.2%}')


# In[58]:


dimensions = ['channel']

conversion_raw, conversion_grouped, conversion_history = get_conversion(
    profiles, orders, observation_date, analysis_horizon, dimensions=dimensions
)

plot_conversion(conversion_grouped, conversion_history, analysis_horizon)


# –í—ã—à–µ –≤—Å–µ–≥–æ –∫–æ–Ω–≤–µ—Ä—Å–∏—è —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø—Ä–∏–≤–ª–µ—á–µ–Ω–Ω—ã—Ö –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º FaceBoom. –ù–æ –≤–æ–æ–±—â–µ, –¥–∏–Ω–∞–º–∏–∫–∏ —É –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–≤—É—Ö–Ω–µ–¥–µ–ª—å–Ω–æ–≥–æ –ª–∞–π—Ñ—Ç–∞–π–º–∞ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∏ –Ω–µ—Ç.

# –°—Ç—Ä–∞–Ω—ã

# In[59]:


dimensions = ['region']

ltv_raw, ltv_grouped, ltv_history, roi_grouped, roi_history = get_ltv(
    profiles, orders, observation_date, analysis_horizon, dimensions=dimensions
)

plot_ltv_roi(
    ltv_grouped, ltv_history, roi_grouped, roi_history, analysis_horizon, window=14
)


# In[60]:


dimensions = ['region']

retention_raw, retention_grouped, retention_history = get_retention(
    profiles, visits, observation_date, analysis_horizon, dimensions=dimensions
)

plot_retention(retention_grouped, retention_history, analysis_horizon)


# –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –æ–≥—Ä–æ–º–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –°–®–ê, —Ç–æ–ª–∫—É –æ—Ç –Ω–∏—Ö –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ—Ç, –æ–Ω–∏ –±—ã—Å—Ç—Ä–æ –ø—Ä–∏—Ö–æ–¥—è—Ç –∏ —Ç–∞–∫ –∂–µ –±—ã—Å—Ç—Ä–æ —É—Ö–æ–¥—è—Ç,
# 
# –∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ä–µ–∫–ª–∞–º—É –≤ –ï–≤—Ä–æ–ø–µ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º–∏ –∏ –æ–∫—É–ø–∞—é—Ç—Å—è, –∞ –≤–æ—Ç –≤ –°–®–ê —Ä–∞—Å—Ç—É—Ç –∏ –ø–µ—Ä–µ—Å—Ç–∞–ª–∏ –æ–∫—É–ø–∞—Ç—å—Å—è —Å –∏—é–Ω—è (–≤–∏–¥–∏–º–æ, –±–ª–∞–≥–æ–¥–∞—Ä—è –≤–ª–∏–≤–∞–Ω–∏—è–º —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –¥–µ–Ω–µ–≥ –≤ TipTop).

# <div class="alert alert-block alert-success">‚úîÔ∏è
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ2__
# 
# –í—Å–µ –≤–µ—Ä–Ω–æ. –ù—É–∂–Ω–æ —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –¥–µ—Ç–∞–ª—å–Ω–µ–µ —Å —Ä–µ–∫–ª–∞–º–æ–π –≤ –°–®–ê, —Ç–µ–º –±–æ–ª–µ–µ, —á—Ç–æ —ç—Ç–æ –Ω–∞—à –æ—Å–Ω–æ–≤–Ω–æ–π —Ä—ã–Ω–æ–∫. 

# In[61]:


dimensions = ['region']

conversion_raw, conversion_grouped, conversion_history = get_conversion(
    profiles, orders, observation_date, analysis_horizon, dimensions=dimensions
)

plot_conversion(conversion_grouped, conversion_history, analysis_horizon)


# –ö–æ–Ω–≤–µ—Ä—Å–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –°–®–ê –ø–æ—á—Ç–∏ –≤ –¥–≤–∞ —Ä–∞–∑–∞ –≤—ã—à–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä–∞–Ω.

# In[62]:


dimensions = ['device']

ltv_raw, ltv_grouped, ltv_history, roi_grouped, roi_history = get_ltv(
    profiles, orders, observation_date, analysis_horizon, dimensions=dimensions
)

plot_ltv_roi(
    ltv_grouped, ltv_history, roi_grouped, roi_history, analysis_horizon, window=14
)


# <div class="alert alert-block alert-danger">‚úç
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ1__
# 
# –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å –ø–æ –¥–µ–≤–∞–π—Å–∞–º. –î–æ–±–∞–≤—å, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞
# </div>

# <div class="alert alert-block alert-danger">‚úç
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ2__
# 
# –ù–∏–∂–µ —É —Ç–µ–±—è –µ—Å—Ç—å —Ä–∞—Å—á—ë—Ç—ã –∫–æ–Ω–≤–µ—Ä—Å–∏–∏–∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø–æ –¥–µ–≤–∞–π—Å–∞–º, –∞ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç. –î–æ–±–∞–≤—å, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞
# </div>

# <div class="alert alert-block alert-warning">üìù
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ3__
# 
# –ù–µ–ø–ª–æ—Ö–æ –±—ã –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ —Å –æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å—é –ø—Ä–æ–±–ª–µ–º—ã –ø–æ –≤—Å–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º –∫—Ä–æ–º–µ PC
# </div>

# –î–µ–≤–∞–π—Å—ã

# In[63]:


dimensions = ['device']

conversion_raw, conversion_grouped, conversion_history = get_conversion(
    profiles, orders, observation_date, analysis_horizon, dimensions=dimensions
)

plot_conversion(conversion_grouped, conversion_history, analysis_horizon)


# –í—Å–µ –¥–µ–≤–∞–π—Å—ã —Ö–æ—Ä–æ—à–æ –∫–æ–Ω–≤–µ—Ä—Å–∏—Ä—É—é—Ç—Å—è, –≤ –ª–∏–¥–µ—Ä–∞—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–∞ –∫–æ–º–ø–∞–Ω–∏–∏ Apple, –∏–∑ –æ–±—â–µ–≥–æ –ø–æ—Ç–æ–∫–∞ –Ω–µ–º–Ω–æ–≥–æ –≤—ã–±–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ PC: –æ–Ω–∏ –ø—Ä–∏–≤–ª–µ–∫–∞—é—Ç—Å—è –Ω–µ —Ç–∞–∫ —É–¥–∞—á–Ω–æ

# In[65]:


dimensions = ['device']

retention_raw, retention_grouped, retention_history = get_retention(
    profiles, visits, observation_date, analysis_horizon, dimensions=dimensions
)

plot_retention(retention_grouped, retention_history, analysis_horizon)


# –°—Ä–µ–¥–∏ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ü–ö. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–∞–∫–±—É–∫–æ–≤ –∏ –∞–π—Ñ–æ–Ω–æ–≤ —É–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ö—É–∂–µ –≤—Å–µ—Ö, –∑–∞—Ç–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ª—É—á—à–µ –≤—Å–µ—Ö

# –í —Ä–∞–∑–±–∏–≤–∫–µ –ø–æ —Å—Ç—Ä–∞–Ω–∞–º –≤–∏–¥–Ω–æ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ä–æ—Å—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –°–®–ê, –æ–Ω–∏ –∂–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏ –Ω–∞ 14 –¥–µ–Ω—å –∏ –Ω–∞ –Ω–∏—Ö –∂–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π —Ä–æ—Å—Ç –≤ –¥–∏–Ω–∞–º–∏–∫–µ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏. –ü–æ –æ—Å—Ç–∞–ª—å–Ω—ã–º —Å—Ç—Ä–∞–Ω–∞–º —Å—Ç–æ–ª—å —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è, –≤—Å–µ –æ–Ω–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å.
# –í—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Ö–æ—Ä–æ—à–æ –∫–æ–Ω–≤–µ—Ä—Å–∏—Ä—É—é—Ç—Å—è, –≤ –ª–∏–¥–µ—Ä–∞—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–∞ –∫–æ–º–ø–∞–Ω–∏–∏ Apple, –∏–∑ –æ–±—â–µ–≥–æ –ø–æ—Ç–æ–∫–∞ –Ω–µ–º–Ω–æ–≥–æ –≤—ã–±–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ PC: –æ–Ω–∏ –ø—Ä–∏–≤–ª–µ–∫–∞—é—Ç—Å—è –Ω–µ —Ç–∞–∫ —É–¥–∞—á–Ω–æ.
# –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –æ–≥—Ä–æ–º–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –°–®–ê, —Ç–æ–ª–∫—É –æ—Ç –Ω–∏—Ö –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ—Ç, –æ–Ω–∏ –±—ã—Å—Ç—Ä–æ –ø—Ä–∏—Ö–æ–¥—è—Ç –∏ —Ç–∞–∫ –∂–µ –±—ã—Å—Ç—Ä–æ —É—Ö–æ–¥—è—Ç,
# –∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ä–µ–∫–ª–∞–º—É –≤ –ï–≤—Ä–æ–ø–µ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º–∏ –∏ –æ–∫—É–ø–∞—é—Ç—Å—è, –∞ –≤–æ—Ç –≤ –°–®–ê —Ä–∞—Å—Ç—É—Ç –∏ –ø–µ—Ä–µ—Å—Ç–∞–ª–∏ –æ–∫—É–ø–∞—Ç—å—Å—è —Å –∏—é–Ω—è (–≤–∏–¥–∏–º–æ, –±–ª–∞–≥–æ–¥–∞—Ä—è –≤–ª–∏–≤–∞–Ω–∏—è–º —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –¥–µ–Ω–µ–≥ –≤ TipTop).
# –ê –≤–æ—Ç —Å —É–¥–µ—Ä–∂–∞–Ω–∏–µ–º –ø–ª–∞—Ç—è—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –°–®–ê —Ö—É–∂–µ –≤—Å–µ—Ö.
# –ù–µ–ø–ª–∞—Ç—è—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é –∫–∞–∫–∏—Ö-—Ç–æ –æ—Ç–ª–∏—á–∏–π (–Ω–∏ —Ç–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –Ω–∏ —Ä–µ–≥–∏–æ–Ω –Ω–∞ –∏—Ö —É–¥–µ—Ä–∂–∞–Ω–∏–µ –Ω–µ –≤–ª–∏—è—é—Ç
# –í—ã—à–µ –≤—Å–µ–≥–æ –∫–æ–Ω–≤–µ—Ä—Å–∏—è —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø—Ä–∏–≤–ª–µ—á–µ–Ω–Ω—ã—Ö –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º FaceBoom. –ù–æ –≤–æ–æ–±—â–µ, –¥–∏–Ω–∞–º–∏–∫–∏ —É –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–≤—É—Ö–Ω–µ–¥–µ–ª—å–Ω–æ–≥–æ –ª–∞–π—Ñ—Ç–∞–π–º–∞ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∏ –Ω–µ—Ç.

# <div class="alert alert-block alert-danger">‚úç
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ1__
# 
# –ê–Ω–∞–ª–∏–∑ –Ω–µ –ø–æ–ª–Ω—ã–π, —Ç.–∫. –ø—Ä–æ–±–ª–µ–º—ã –º–æ–≥—É—Ç –±—ã—Ç—å –≤ —É–¥–µ—Ä–∂–∞–Ω–∏–∏ –∫–∞–Ω–∞–ª–æ–≤/—Å—Ç—Ä–∞–Ω/—É—Å—Ç—Ä–æ–π—Å—Ç–≤/, –∞ –±–µ–∑ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è, –º—ã –Ω–µ —Å–º–æ–∂–µ–º –¥–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥–∞–º.
# </div>

# <div class="alert alert-block alert-success">‚úîÔ∏è
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ3__
# 
# –•–æ—Ä–æ—à–æ, –∞–Ω–∞–ª–∏–∑ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω, —Å–æ–≥–ª–∞—Å–µ–Ω —Å –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–µ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤–µ—Ä–Ω–æ.

# ### –ù–∞–ø–∏—à–∏—Ç–µ –≤—ã–≤–æ–¥—ã
# 
# - –í—ã–¥–µ–ª–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—ã –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
# - –°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –æ—Ç–¥–µ–ª–∞ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞.

# 

# –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –±—ã–ª–æ –≤—ã—è–≤–ª–µ–Ω–æ, —á—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∏—á–∏–Ω–æ–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º —è–≤–ª—è—é—Ç—Å—è —Ä–µ–∫–ª–∞–º–Ω—ã–µ —Ç—Ä–∞—Ç—ã –Ω–∞ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º FaceBoom, TipTop –≤ –°–®–ê –∏ AdNonSence –≤ –ï–≤—Ä–æ–ø–µ (—Ç–æ–ø3 –°–ê–°):
# 
# –≤—ã—Å–æ–∫–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è —É —ç—Ç–∏—Ö –∫–∞–Ω–∞–ª–æ–≤, —Å –≥–æ—Ä–∏–∑–æ–Ω—Ç–æ–º —Å–æ–±—ã—Ç–∏–π –≤ –¥–≤–µ –Ω–µ–¥–µ–ª–∏ –æ–Ω–∞ –Ω–µ –æ–∫—É–ø–∞–µ—Ç—Å—è;
# 
# –ø—Ä–∏ —ç—Ç–æ–º, –ø–ª–∞—Ç—è—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ FaceBoom –∏ AdNonSence –æ—á–µ–Ω—å –ø–ª–æ—Ö–æ —É–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è;
# 
# —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –≤ TipTop –∑–∞ –ø–æ–ª–≥–æ–¥–∞ –≤—ã—Ä–æ—Å–ª–∏ –ø–æ—á—Ç–∏ –≤ —Ç—Ä–∏ —Ä–∞–∑–∞.

# –ö–∞–Ω–∞–ª TipTop —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–æ–±–ª–µ–º–Ω—ã–º. –û–Ω –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (10%), –Ω–æ —É –Ω–µ–≥–æ —Å–∞–º—ã–µ –≤—ã—Å–æ–∫–∏–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ä–µ–∫–ª–∞–º—É. –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ –Ω–µ–≥–æ –Ω–µ –æ–∫—É–ø–∞—é—Ç—Å—è. –í–æ–∑–º–æ–∂–Ω–æ, –ª—É—á—à–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∫–ª–∞–º–Ω—ã–π –±—é–¥–∂–µ—Ç –¥–ª—è –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è –≤ –∫–∞–Ω–∞–ª–∞—Ö WahooNetBanner –∏ RocketSuperAds. –û–Ω–∏ –ø—Ä–∏–≤–ª–µ–∫–∞—é—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Å—Ç–æ–ª—å–∫–æ –∂–µ –ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ –º–µ–Ω—å—à–∏—Ö —Ä–∞—Å—Ö–æ–¥–∞—Ö –Ω–∞ —Ä–µ–∫–ª–∞–º—É.

# –í –∫–∞—á–µ—Å—Ç–≤–µ —Å–ª–µ–¥—É—é—à–∏—Ö —à–∞–≥–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:
#  –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç FaceBoom –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∫–ª–∞–º–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –≤ –ø–æ–ª—å–∑—É –¥—Ä—É–≥–∏—Ö –∫–∞–Ω–∞–ª–æ–≤
#  –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –µ–≤—Ä–æ–ø–µ–π—Å–∫–∏–π —Ä—ã–Ω–æ–∫ (—É–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ä–µ–∫–ª–∞–º—É –≤ lambdaMediaAds –∏ —Å–Ω–∏–∑–∏—Ç—å –≤ AdNonSense–∏)
#  –ø—Ä–∏–≤–ª–µ—á—å –∏ –∑–∞–º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

# –°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≥–æ—Ä–∞–∑–¥–æ –≤—ã—à–µ, —á–µ–º –≤ –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä–∞–Ω–∞—Ö. –ö–∞–∫ —Å–ª–µ–¥—Å—Ç–≤–∏–µ, —Ä–µ–∫–ª–∞–º–∞ –≤ –°–®–ê –Ω–µ –æ–∫—É–ø–∞–µ—Ç—Å—è. –ù–∞–∏—Ö—É–¥—à–µ–µ —É–¥–µ—Ä–∂–∞–Ω–∏–µ —Ç–∞–∫–∂–µ –≤ –°–®–ê. –í–æ–∑–º–æ–∂–Ω–æ, —Å—Ç–æ–∏—Ç —Å–æ–∫—Ä–∞—Ç–∏—Ç—å —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ä–µ–∫–ª–∞–º—É –≤ –°–®–ê –∏ —Å—ç–∫–æ–Ω–æ–º–ª–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —É–ª—É—á—à–µ–Ω–∏–µ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ–¥ –≤–∫—É—Å—ã –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏.

# <div class="alert alert-block alert-danger">‚úç
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ1__
#     
#   ‚ùå –í —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ –¥–∞—Ç—å –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é –≥—Ä–∞—Ñ–∏–∫–∞–º –∏ –Ω–∞–ø–∏—Å–∞—Ç—å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–µ –≤—ã–≤–æ–¥—ã.
# –ù–∞–º –Ω–∞–¥–æ –Ω–∞–π—Ç–∏ –∏ —É–∫–∞–∑–∞—Ç—å –ø—Ä–∏—á–∏–Ω—ã –ø–ª–æ—Ö–æ–π –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏ —Ä–µ–∫–ª–∞–º—ã: 
# - —Ä–µ–∫–ª–∞–º–∞ –≤ –°–®–ê - –ø—Ä–æ–±–ª–µ–º—ã —Ç–∞–∫–∏–µ-—Ç–æ
# - –∫–∞–Ω–∞–ª TipTop - —É–≤–µ–ª–∏—á–µ–Ω–∏–µ ..?
# - –∫–∞–Ω–∞–ª FaceBoom, AdNonSense - –ø—Ä–æ–±–ª–µ–º—ã —Å ..?\
# –∏ —Ç.–¥.
# 
# –ê —Ç–∞–∫-–∂–µ –µ—â–µ –Ω–∞–ø–∏—Å–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–º —Ä–µ–≥–∏–æ–Ω–∞–º –∏ –∫–∞–Ω–∞–ª–∞–º: –Ω–∞ –∫–∞–∫–æ–π –æ–∫—É–ø–∞—é—â–∏–π—Å—è –∏—Å—Ç–æ—á–Ω–∏–∫ —Å–ª–µ–¥—É–µ—Ç –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ–±—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ä–µ–∫–ª–∞–º—É –≤ –°–®–ê? –ö–∞–∫–∏–µ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –ø–æ—Å–æ–≤–µ—Ç–æ–≤–∞—Ç—å –ø–æ –ï–≤—Ä–æ–ø–µ, —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —Å–∏—Ç—É–∞—Ü–∏—é —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ –∏ —Ç.–¥.  –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥–∏ –æ—Ü–µ–Ω—è—Ç! üôÇ
# 
# </div>

# <div class="alert alert-block alert-danger">‚úç
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ2__
#     
# –¢—É—Ç –Ω–∞–≤–ª–æ–≥–∏—á–Ω–æ, –Ω–µ —É–≤–∏–¥–µ–ª: –∞ –∫–∞–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Ä–µ–∫–ª–∞–º–µ –°–®–ê? –ö–∞–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–∞–Ω–∞–ª–æ–º AdNonSense –∏ —Ç.–ø. –ù–µ —Å—Ç–æ–∏—Ç —Å–∫—É–ø–∏—Ç—å—Å—è –Ω–∞ —Å–ª–æ–≤–∞
# 
# </div>

# <div class="alert alert-block alert-success">‚úîÔ∏è
#     
# 
# __–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ3__
# –û—Ç–ª–∏—á–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –æ—Ç–¥–µ–ª–∞ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞) –ú–æ–ª–æ–¥–µ—Ü
# </div>

# 

# 

# <div class="alert alert-block alert-warning">üìù
# –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ1 </b> 
# 
# 
# 
# –£ —Ç–µ–±—è –ø–æ–ª—É—á–∏–ª–∞—Å—å –æ—á–µ–Ω—å —Å–∏–ª—å–Ω–∞—è –∏ —Ö–æ—Ä–æ—à–∞—è —Ä–∞–±–æ—Ç–∞. –ó–¥–æ—Ä–æ–≤–æ, —á—Ç–æ —Ä–∞—Å—á–µ—Ç—ã —Ç—ã —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞–µ—à—å –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è–º–∏, –∞ —Ç–∞–∫ –∂–µ –Ω–µ –∑–∞–±—ã–≤–∞–µ—à—å –ø—Ä–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, —Ç–≤–æ–π –ø—Ä–æ–µ–∫—Ç –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å. 
# 
# ---
# 
# –ù—É–∂–Ω–æ –ø–æ–ø—Ä–∞–≤–∏—Ç—å:
# 
# 1) –í–≤–æ–¥–Ω–∞—è —á–∞—Å—Ç—å
# 
# 2) –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–æ–ø—É—Å–∫–∏ –∏ –¥—É–±–ª–∏–∫–∞—Ç—ã
# 
# 3) –í–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∏–Ω–∞–º–∏–∫—É —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ –∫–∞–Ω–∞–ª–∞–º, –ø–æ –º–µ—Å—è—Ü–∞–º –∏ –Ω–µ–¥–µ–ª—è–º (2 –≥—Ä–∞—Ñ–∏–∫–∞)
# 
# 4) –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ / –≥—Ä–∞—Ñ–∏–∫–∞ (–∏–ª–∏ —Å–µ—Ä–∏–∏ —Ç–µ—Å—Ç–æ–≤) –ø–∏—Å–∞—Ç—å –≤—ã–≤–æ–¥ –ø–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º —Å —É—á–µ—Ç–æ–º –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π –±–∏–∑–Ω–µ—Å –∑–∞–¥–∞—á–∏
# 
# 5) –û–∫—É–ø–∞–µ–º–æ—Å—Ç—å –¥–µ–≤–∞–π—Å–æ–≤
# 
# 6) –ö–æ–Ω–≤–µ—Ä—Å–∏—è –∏ —É–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º (—Å—Ç—Ä–∞–Ω—ã / –∫–∞–Ω–∞–ª—ã / –¥–µ–≤–∞–π—Å—ã)
# 
# 7) –§–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥
# 
# 8) –ü–æ–¥–ø—Ä–∞–≤–∏—Ç—å –≤—ã–≤–æ–¥—ã, –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
# 
# ----
# 
# 
# –ï—Å–ª–∏ —É —Ç–µ–±—è –±—É–¥—É—Ç –∫–∞–∫–∏–µ-—Ç–æ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –º–æ–∏–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–∏—à–∏! –ë—É–¥—É –∂–¥–∞—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ —Ä–µ–≤—å—é :)</div>

# <div class="alert alert-info"> <b> –î–æ–ø–æ–ª–Ω–∏–ª –≤—Å–µ –ø—É–Ω–∫—Ç—ã, –¥–æ–±–∞–≤–∏–ª –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –ø–æ –≤—Å–µ–º –∫—Ä–∏—Ç–µ—Ä–∏—è–µ–º, –æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å –¥–µ–≤–∞–π—Å–æ–≤, –ø—Ä–æ–≤–µ—Ä–∏–ª –¥—É–±–ª–∏–∫–∞—Ç—ã –∏ –ø—Ä–æ–ø—É—Å–∫–∏, –¥–æ–ø–æ–ª–Ω–∏–ª –≤—ã–≤–æ–¥—ã –∫ –≥—Ä–∞—Ñ–∏–∫–∞–º –∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥</b>

# <div class="alert alert-block alert-warning">üìù
# –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ2 </b> 
# 
# 
# 
# –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞, –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—Ä–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–æ–º–µ–Ω—Ç–æ–≤: 
# 
# ---
# 
# –ù—É–∂–Ω–æ –ø–æ–ø—Ä–∞–≤–∏—Ç—å:
# 
# 
# 1) –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ / –≥—Ä–∞—Ñ–∏–∫–∞ (–∏–ª–∏ —Å–µ—Ä–∏–∏ —Ç–µ—Å—Ç–æ–≤) –ø–∏—Å–∞—Ç—å –≤—ã–≤–æ–¥ –ø–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º —Å —É—á–µ—Ç–æ–º –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π –±–∏–∑–Ω–µ—Å –∑–∞–¥–∞—á–∏
# 
# 2) –û–∫—É–ø–∞–µ–º–æ—Å—Ç—å –¥–µ–≤–∞–π—Å–æ–≤
# 
# 3) –§–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥
# 
# 4) –ü–æ–¥–ø—Ä–∞–≤–∏—Ç—å –≤—ã–≤–æ–¥—ã, –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
# 
# ----
# 
# 
# –ï—Å–ª–∏ —É —Ç–µ–±—è –±—É–¥—É—Ç –∫–∞–∫–∏–µ-—Ç–æ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –º–æ–∏–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–∏—à–∏! –ë—É–¥—É –∂–¥–∞—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ —Ä–µ–≤—å—é :)</div>

# <div style="border:solid blue 3px; padding: 20px">
# <div class="alert alert-block alert-success">‚úîÔ∏è
#     
# 
# __–ö–æ–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —Ä–µ–≤—å—é–µ—Ä–∞ ‚Ññ3__
# 
#     
# –í –æ—Å—Ç–∞–ª—å–Ω–æ–º –≤—Å—ë —á—É–¥–Ω–æüòä. –¢–≤–æ–π –ø—Ä–æ–µ–∫—Ç —Ç–∞–∫ –∏ –ø—Ä–æ—Å–∏—Ç—Å—è –Ω–∞ github =)   
#     
# –ü–æ–∑–¥—Ä–∞–≤–ª—è—é —Å —É—Å–ø–µ—à–Ω—ã–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º –ø—Ä–æ–µ–∫—Ç–∞ üòäüëç
# –ò –∂–µ–ª–∞—é —É—Å–ø–µ—Ö–æ–≤ –≤ –Ω–æ–≤—ã—Ö —Ä–∞–±–æ—Ç–∞—Ö üòä
# 
# ---
# 
# –û—Ç —Å–µ–±—è —Ö–æ—á—É –ø–æ—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å —Ç–µ–±–µ –æ—Ç–ª–∏—á–Ω—ã–π –º–µ—Ç–µ—Ä–∏–∞–ª –ø—Ä–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É –î–º–∏—Ç—Ä–∏—è –ñ–∏–≤–æ—Ç–≤–æ—Ä–µ–≤–∞. 
#     
# https://www.youtube.com/watch?v=Vy_rq-x9QEo
#     

# 
